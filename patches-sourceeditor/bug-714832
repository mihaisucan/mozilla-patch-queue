# HG changeset patch
# Parent 59c5ee47dc45209155bf2abbbe28422e0b0f2786
# User Thaddee Tyl <thaddee.tyl@gmail.com>
Bug 714832 - [Linux] the redo command should also have the ctrl-y shortcut; try: -b do -p linux,linuxqt,linux64,macosx64,win32,macosx -u mochitest-o -t none

diff --git a/browser/devtools/sourceeditor/source-editor-orion.jsm b/browser/devtools/sourceeditor/source-editor-orion.jsm
--- a/browser/devtools/sourceeditor/source-editor-orion.jsm
+++ b/browser/devtools/sourceeditor/source-editor-orion.jsm
@@ -126,16 +126,25 @@ const DEFAULT_KEYBINDINGS = [
   },
   {
     action: "Move to Bracket Closing",
     code: Ci.nsIDOMKeyEvent.DOM_VK_CLOSE_BRACKET,
     accel: true,
   },
 ];
 
+if (Services.appinfo.OS == "WINNT" ||
+    Services.appinfo.OS == "Linux") {
+  DEFAULT_KEYBINDINGS.push({
+    action: "redo",
+    code: Ci.nsIDOMKeyEvent.DOM_VK_Y,
+    accel: true,
+  });
+}
+
 var EXPORTED_SYMBOLS = ["SourceEditor"];
 
 /**
  * The SourceEditor object constructor. The SourceEditor component allows you to
  * provide users with an editor tailored to the specific needs of editing source
  * code, aimed primarily at web developers.
  *
  * The editor used here is Eclipse Orion (see http://www.eclipse.org/orion).
diff --git a/browser/devtools/sourceeditor/test/browser_sourceeditor_initialization.js b/browser/devtools/sourceeditor/test/browser_sourceeditor_initialization.js
--- a/browser/devtools/sourceeditor/test/browser_sourceeditor_initialization.js
+++ b/browser/devtools/sourceeditor/test/browser_sourceeditor_initialization.js
@@ -93,16 +93,29 @@ function editorLoaded()
   EventUtils.synthesizeKey("VK_Z", {accelKey: true}, testWin);
 
   is(editor.getText(), "source-editor", "Ctrl-Z (undo) works");
 
   EventUtils.synthesizeKey("VK_Z", {accelKey: true, shiftKey: true}, testWin);
 
   is(editor.getText(), "code-editor", "Ctrl-Shift-Z (redo) works");
 
+  editor.undo();
+
+  EventUtils.synthesizeKey("VK_Y", {accelKey: true}, testWin);
+  if (Services.appinfo.OS == "WINNT" ||
+      Services.appinfo.OS == "Linux") {
+    is(editor.getText(), "code-editor",
+       "CTRL+Y does redo on Linux and Windows");
+  } else {
+    is(editor.getText(), "source-editor",
+       "CTRL+Y doesn't redo on machines other than Linux and Windows");
+    editor.setText("code-editor");
+  }
+
   // Test selection methods.
 
   editor.setSelection(0, 4);
 
   is(editor.getSelectedText(), "code", "getSelectedText() works");
 
   let selection = editor.getSelection();
   ok(selection.start == 0 && selection.end == 4, "getSelection() works");
