# HG changeset patch
# Parent f4c9de8fa57c16feff2dd2f1dd84b14c41221834
# User Tanvi Vyas <tvyas@mozilla.com>
writing mochitests for mixed content bug
* * *
Udpates to mochitest1

diff --git a/browser/devtools/webconsole/test/Makefile.in b/browser/devtools/webconsole/test/Makefile.in
--- a/browser/devtools/webconsole/test/Makefile.in
+++ b/browser/devtools/webconsole/test/Makefile.in
@@ -105,16 +105,17 @@ include $(topsrcdir)/config/rules.mk
 	browser_webconsole_bug_664131_console_group.js \
 	browser_webconsole_bug_704295.js \
 	browser_webconsole_bug_658368_time_methods.js \
 	browser_webconsole_bug_622303_persistent_filters.js \
 	browser_webconsole_window_zombie.js \
 	browser_cached_messages.js \
 	browser_bug664688_sandbox_update_after_navigation.js \
 	browser_webconsole_menustatus.js \
+	browser_webconsole_bug_737873_mixedcontent.js \
 	head.js \
 	$(NULL)
 
 _BROWSER_TEST_PAGES = \
 	test-console.html \
 	test-network.html \
 	test-network-request.html \
 	test-mutation.html \
@@ -177,15 +178,16 @@ include $(topsrcdir)/config/rules.mk
 	test-bug-585956-console-trace.html \
 	test-bug-644419-log-limits.html \
 	test-bug-632275-getters.html \
 	test-bug-646025-console-file-location.html \
 	test-file-location.js \
 	test-bug-658368-time-methods.html \
 	test-webconsole-error-observer.html \
 	test-for-of.html \
+  browser_webconsole_bug_737873_mixedcontent.html \
 	$(NULL)
 
 libs:: $(_BROWSER_TEST_FILES)
 	$(INSTALL) $(foreach f,$^,"$f") $(DEPTH)/_tests/testing/mochitest/browser/$(relativesrcdir)
 
 libs:: $(_BROWSER_TEST_PAGES)
 	$(INSTALL) $(foreach f,$^,"$f") $(DEPTH)/_tests/testing/mochitest/browser/$(relativesrcdir)
diff --git a/browser/devtools/webconsole/test/browser_webconsole_bug_737873_mixedcontent.html b/browser/devtools/webconsole/test/browser_webconsole_bug_737873_mixedcontent.html
new file mode 100644
--- /dev/null
+++ b/browser/devtools/webconsole/test/browser_webconsole_bug_737873_mixedcontent.html
@@ -0,0 +1,10 @@
+<!DOCTYPE HTML>
+<html dir="ltr" xml:lang="en-US" lang="en-US"><head>
+    <title>Mixed Content test - http on https</title>
+    <script src="testscript.js"></script>  
+  </head>
+  <body>
+    <iframe src = "http://example.com"></iframe>
+  </body>
+</html>
+
diff --git a/browser/devtools/webconsole/test/browser_webconsole_bug_737873_mixedcontent.js b/browser/devtools/webconsole/test/browser_webconsole_bug_737873_mixedcontent.js
new file mode 100644
--- /dev/null
+++ b/browser/devtools/webconsole/test/browser_webconsole_bug_737873_mixedcontent.js
@@ -0,0 +1,61 @@
+
+
+const TEST_HTTPS_URI = "https://example.com/browser/browser/devtools/webconsole/test/browser_webconsole_bug_737873_mixedcontent.html";
+//const TEST_HTTPS_URI = "https://people.mozilla.com/~bsterne/tests/62178/test.html";
+//const TEST_HTTPS_URI = "https://eventbrite.com";
+
+function test() {
+  addTab("data:text/html,Web Console basic network logging test");
+  browser.addEventListener("load", onLoad, true);
+}
+
+function onLoad(aEvent) {
+  browser.removeEventListener(aEvent.type, arguments.callee, true);
+  //browser.removeEventListener("load", onLoad, true);
+  openConsole();
+
+  browser.addEventListener("load", testMixedContentLogging, true);
+  content.location = TEST_HTTPS_URI;
+}
+
+function testMixedContentLogging(aEvent) {
+  browser.removeEventListener(aEvent.type, arguments.callee, true);
+  //browser.removeEventListener("load", testMixedContentLogging, true);
+
+  let aOutputNode = HUDService.getHudByWindow(content).outputNode;
+
+  let selector = ".hud-msg-node";
+  let msgs = aOutputNode.querySelectorAll(selector);
+  let found = false;
+  for (let i = 0, n = msgs.length; i < n; i++) {
+    let message = msgs[i].textContent.indexOf("[Mixed Content]");
+    if (message > -1) {
+      found = true;
+      break;
+    }
+  }
+  ok(found, "Log Entry found is:" + found);
+
+  //finishTest();
+
+}
+
+
+
+
+function testcolor(outputNode) {
+
+
+
+}
+
+function testseverity(outputNode) {
+
+
+}
+
+function testmessagetext(outputNode) {
+
+  findLogEntry("[Mixed Content]");
+}
+
