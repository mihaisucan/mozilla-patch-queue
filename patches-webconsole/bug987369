# HG changeset patch
# Parent 3f6c3e721ac082f875e42485143321036568abbd
# User Mihai Sucan <mihai.sucan@gmail.com>
# Date 1395745313 -7200

Bug 987369 - Fix for `aRawObj.location is null` in script.js; r=benvie

diff --git a/toolkit/devtools/server/actors/script.js b/toolkit/devtools/server/actors/script.js
--- a/toolkit/devtools/server/actors/script.js
+++ b/toolkit/devtools/server/actors/script.js
@@ -3699,17 +3699,17 @@ DebuggerServer.ObjectActorPreviewers.Obj
         !(aRawObj instanceof Ci.nsIDOMCSSImportRule ||
           aRawObj instanceof Ci.nsIDOMCSSStyleSheet ||
           aRawObj instanceof Ci.nsIDOMLocation ||
           aRawObj instanceof Ci.nsIDOMWindow)) {
       return false;
     }
 
     let url;
-    if (aRawObj instanceof Ci.nsIDOMWindow) {
+    if (aRawObj instanceof Ci.nsIDOMWindow && aRawObj.location) {
       url = aRawObj.location.href;
     } else {
       url = aRawObj.href;
     }
 
     aGrip.preview = {
       kind: "ObjectWithURL",
       url: threadActor.createValueGrip(url),
@@ -3785,17 +3785,17 @@ DebuggerServer.ObjectActorPreviewers.Obj
     }
 
     let preview = aGrip.preview = {
       kind: "DOMNode",
       nodeType: aRawObj.nodeType,
       nodeName: aRawObj.nodeName,
     };
 
-    if (aRawObj instanceof Ci.nsIDOMDocument) {
+    if (aRawObj instanceof Ci.nsIDOMDocument && aRawObj.location) {
       preview.location = threadActor.createValueGrip(aRawObj.location.href);
     } else if (aRawObj instanceof Ci.nsIDOMDocumentFragment) {
       preview.childNodesLength = aRawObj.childNodes.length;
 
       if (threadActor._gripDepth < 2) {
         preview.childNodes = [];
         for (let node of aRawObj.childNodes) {
           let actor = threadActor.createValueGrip(obj.makeDebuggeeValue(node));
