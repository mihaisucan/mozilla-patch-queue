# HG changeset patch
# User Panos Astithas <past@mozilla.com>
# Date 1361261158 -7200
# Node ID 9b653fc11afa44869b22fa432ff6f5fba24bb330
# Parent  3892377f7e53964189d02e662ed2c31727a4270c
Ensure new globals and chrome scripts will be generated on time in browser_dbg_chrome-debugging.js

diff --git a/browser/devtools/debugger/test/browser_dbg_chrome-debugging.js b/browser/devtools/debugger/test/browser_dbg_chrome-debugging.js
--- a/browser/devtools/debugger/test/browser_dbg_chrome-debugging.js
+++ b/browser/devtools/debugger/test/browser_dbg_chrome-debugging.js
@@ -3,16 +3,17 @@
  * Any copyright is dedicated to the Public Domain.
  * http://creativecommons.org/publicdomain/zero/1.0/
  */
 
 // Tests that chrome debugging works.
 
 var gClient = null;
 var gTab = null;
+var gHomeTab = null;
 var gThreadClient = null;
 var gNewGlobal = false;
 var gAttached = false;
 var gChromeScript = false;
 const DEBUGGER_TAB_URL = EXAMPLE_URL + "browser_dbg_debuggerstatement.html";
 
 function test()
 {
@@ -28,18 +29,17 @@ function test()
         gClient.addListener("newScript", onNewScript);
 
         gClient.attachThread(dbg, function(aResponse, aThreadClient) {
           gThreadClient = aThreadClient;
           ok(!aResponse.error, "Attached to the chrome debugger.");
           gAttached = true;
 
           // Ensure that a new global will be created.
-          let frame = content.document.createElement("iframe");
-          content.document.querySelector("body").appendChild(frame);
+          gHomeTab = gBrowser.addTab("about:home");
 
           finish_test();
         });
       });
     });
   });
 }
 
@@ -53,16 +53,17 @@ function onNewScript(aEvent, aScript)
 
 function finish_test()
 {
   if (!gAttached || !gChromeScript) {
     return;
   }
   gClient.removeListener("newScript", onNewScript);
   gThreadClient.resume(function(aResponse) {
+    removeTab(gHomeTab);
     removeTab(gTab);
     gClient.close(function() {
       ok(gNewGlobal, "Received newGlobal event.");
       ok(gChromeScript, "Received newScript event for a chrome: script.");
       finish();
     });
   });
 }
