# HG changeset patch
# Parent 81281975e2f86675e0ff5096b55f5f9039afbbc5
# User Mihai Sucan <mihai.sucan@gmail.com>
# Date 1387278560 -7200

Bug 843004 - Part 4: test fixes; r=benvie; try: -b do -p all -u all -t none

diff --git a/browser/devtools/debugger/test/browser_dbg_closure-inspection.js b/browser/devtools/debugger/test/browser_dbg_closure-inspection.js
--- a/browser/devtools/debugger/test/browser_dbg_closure-inspection.js
+++ b/browser/devtools/debugger/test/browser_dbg_closure-inspection.js
@@ -72,23 +72,23 @@ function test() {
           return;
         }
         window.clearInterval(intervalID);
 
         is(personNode.get("getName").target.querySelector(".name")
            .getAttribute("value"), "getName",
           "Should have the right property name for 'getName' in person.");
         is(personNode.get("getName").target.querySelector(".value")
-           .getAttribute("value"), "Function",
+           .getAttribute("value"), "_pfactory/<.getName()",
           "'getName' in person should have the right value.");
         is(personNode.get("getFoo").target.querySelector(".name")
            .getAttribute("value"), "getFoo",
           "Should have the right property name for 'getFoo' in person.");
         is(personNode.get("getFoo").target.querySelector(".value")
-           .getAttribute("value"), "Function",
+           .getAttribute("value"), "_pfactory/<.getFoo()",
           "'getFoo' in person should have the right value.");
 
         // Expand the function nodes. This causes their properties to be
         // retrieved and displayed.
         let getFooNode = personNode.get("getFoo");
         let getNameNode = personNode.get("getName");
         getFooNode.expand();
         getNameNode.expand();
diff --git a/browser/devtools/debugger/test/browser_dbg_pause-exceptions-01.js b/browser/devtools/debugger/test/browser_dbg_pause-exceptions-01.js
--- a/browser/devtools/debugger/test/browser_dbg_pause-exceptions-01.js
+++ b/browser/devtools/debugger/test/browser_dbg_pause-exceptions-01.js
@@ -53,17 +53,17 @@ function testPauseOnExceptionsDisabled()
 
     is(gFrames.itemCount, 1,
       "Should have one frame.");
     is(gVariables._store.length, 3,
       "Should have three scopes.");
 
     is(innerNodes[0].querySelector(".name").getAttribute("value"), "this",
       "Should have the right property name for 'this'.");
-    is(innerNodes[0].querySelector(".value").getAttribute("value"), "HTMLButtonElement",
+    is(innerNodes[0].querySelector(".value").getAttribute("value"), "<button>",
       "Should have the right property value for 'this'.");
 
     let finished = waitForDebuggerEvents(gPanel, gDebugger.EVENTS.AFTER_FRAMES_CLEARED).then(() => {
       isnot(gDebugger.gThreadClient.state, "paused",
         "Should not be paused after resuming.");
       ok(isCaretPos(gPanel, 26),
         "Should be idle on the debugger statement.");
 
@@ -119,17 +119,17 @@ function testPauseOnExceptionsEnabled() 
 
       is(gFrames.itemCount, 1,
         "Should have one frame.");
       is(gVariables._store.length, 3,
         "Should have three scopes.");
 
       is(innerNodes[0].querySelector(".name").getAttribute("value"), "this",
         "Should have the right property name for 'this'.");
-      is(innerNodes[0].querySelector(".value").getAttribute("value"), "HTMLButtonElement",
+      is(innerNodes[0].querySelector(".value").getAttribute("value"), "<button>",
         "Should have the right property value for 'this'.");
 
       let finished = waitForDebuggerEvents(gPanel, gDebugger.EVENTS.AFTER_FRAMES_CLEARED).then(() => {
         isnot(gDebugger.gThreadClient.state, "paused",
           "Should not be paused after resuming.");
         ok(isCaretPos(gPanel, 26),
           "Should be idle on the debugger statement.");
 
diff --git a/browser/devtools/debugger/test/browser_dbg_pause-exceptions-02.js b/browser/devtools/debugger/test/browser_dbg_pause-exceptions-02.js
--- a/browser/devtools/debugger/test/browser_dbg_pause-exceptions-02.js
+++ b/browser/devtools/debugger/test/browser_dbg_pause-exceptions-02.js
@@ -74,17 +74,17 @@ function testPauseOnExceptionsAfterReloa
 
       is(gFrames.itemCount, 1,
         "Should have one frame.");
       is(gVariables._store.length, 3,
         "Should have three scopes.");
 
       is(innerNodes[0].querySelector(".name").getAttribute("value"), "this",
         "Should have the right property name for 'this'.");
-      is(innerNodes[0].querySelector(".value").getAttribute("value"), "HTMLButtonElement",
+      is(innerNodes[0].querySelector(".value").getAttribute("value"), "<button>",
         "Should have the right property value for 'this'.");
 
       let finished = waitForDebuggerEvents(gPanel, gDebugger.EVENTS.AFTER_FRAMES_CLEARED).then(() => {
         isnot(gDebugger.gThreadClient.state, "paused",
           "Should not be paused after resuming.");
         ok(isCaretPos(gPanel, 26),
           "Should be idle on the debugger statement.");
 
diff --git a/browser/devtools/debugger/test/browser_dbg_variables-view-edit-value.js b/browser/devtools/debugger/test/browser_dbg_variables-view-edit-value.js
--- a/browser/devtools/debugger/test/browser_dbg_variables-view-edit-value.js
+++ b/browser/devtools/debugger/test/browser_dbg_variables-view-edit-value.js
@@ -17,26 +17,26 @@ function test() {
     gPanel = aPanel;
     gDebugger = gPanel.panelWin;
     gVars = gDebugger.DebuggerView.Variables;
 
     waitForSourceAndCaretAndScopes(gPanel, ".html", 24)
       .then(() => initialChecks())
       .then(() => testModification("a", "1"))
       .then(() => testModification("{ a: 1 }", "Object"))
-      .then(() => testModification("[a]", "Array"))
+      .then(() => testModification("[a]", "Array[1]"))
       .then(() => testModification("b", "Object"))
       .then(() => testModification("b.a", "1"))
       .then(() => testModification("c.a", "1"))
       .then(() => testModification("Infinity", "Infinity"))
       .then(() => testModification("NaN", "NaN"))
-      .then(() => testModification("new Function", "Function"))
+      .then(() => testModification("new Function", "anonymous()"))
       .then(() => testModification("+0", "0"))
       .then(() => testModification("-0", "-0"))
-      .then(() => testModification("Object.keys({})", "Array"))
+      .then(() => testModification("Object.keys({})", "Array[0]"))
       .then(() => testModification("document.title", '"Debugger test page"'))
       .then(() => resumeDebuggerThenCloseAndFinish(gPanel))
       .then(null, aError => {
         ok(false, "Got an error: " + aError.message + "\n" + aError.stack);
       });
 
     EventUtils.sendMouseEvent({ type: "click" },
       gDebuggee.document.querySelector("button"),
diff --git a/browser/devtools/debugger/test/browser_dbg_variables-view-frame-parameters-01.js b/browser/devtools/debugger/test/browser_dbg_variables-view-frame-parameters-01.js
--- a/browser/devtools/debugger/test/browser_dbg_variables-view-frame-parameters-01.js
+++ b/browser/devtools/debugger/test/browser_dbg_variables-view-frame-parameters-01.js
@@ -84,24 +84,26 @@ function testExpandVariables() {
   is(argsVar.expanded, false,
     "The argsVar should not be expanded at this point.");
   is(cVar.expanded, false,
     "The cVar should not be expanded at this point.");
 
   waitForDebuggerEvents(gPanel, gDebugger.EVENTS.FETCHED_PROPERTIES, 3).then(() => {
     is(thisVar.get("window").target.querySelector(".name").getAttribute("value"), "window",
       "Should have the right property name for 'window'.");
-    is(thisVar.get("window").target.querySelector(".value").getAttribute("value"), "Window",
+    is(thisVar.get("window").target.querySelector(".value").getAttribute("value"),
+      "Window \u2192 doc_frame-parameters.html",
       "Should have the right property value for 'window'.");
     ok(thisVar.get("window").target.querySelector(".value").className.contains("token-other"),
       "Should have the right token class for 'window'.");
 
     is(thisVar.get("document").target.querySelector(".name").getAttribute("value"), "document",
       "Should have the right property name for 'document'.");
-    is(thisVar.get("document").target.querySelector(".value").getAttribute("value"), "HTMLDocument",
+    is(thisVar.get("document").target.querySelector(".value").getAttribute("value"),
+      "HTMLDocument \u2192 doc_frame-parameters.html",
       "Should have the right property value for 'document'.");
     ok(thisVar.get("document").target.querySelector(".value").className.contains("token-other"),
       "Should have the right token class for 'document'.");
 
     let argsProps = argsVar.target.querySelectorAll(".variables-view-property");
     is(argsProps.length, 8,
       "The 'arguments' variable should contain 5 enumerable and 3 non-enumerable properties");
 
diff --git a/browser/devtools/debugger/test/browser_dbg_variables-view-frame-parameters-02.js b/browser/devtools/debugger/test/browser_dbg_variables-view-frame-parameters-02.js
--- a/browser/devtools/debugger/test/browser_dbg_variables-view-frame-parameters-02.js
+++ b/browser/devtools/debugger/test/browser_dbg_variables-view-frame-parameters-02.js
@@ -51,17 +51,18 @@ function testScopeVariables() {
 
   is(localEnums.length, 12,
     "The local scope should contain all the created enumerable elements.");
   is(localNonEnums.length, 0,
     "The local scope should contain all the created non-enumerable elements.");
 
   is(localEnums[0].querySelector(".name").getAttribute("value"), "this",
     "Should have the right property name for 'this'.");
-  is(localEnums[0].querySelector(".value").getAttribute("value"), "Window",
+  is(localEnums[0].querySelector(".value").getAttribute("value"),
+    "Window \u2192 doc_frame-parameters.html",
     "Should have the right property value for 'this'.");
   ok(localEnums[0].querySelector(".value").className.contains("token-other"),
     "Should have the right token class for 'this'.");
 
   is(localEnums[1].querySelector(".name").getAttribute("value"), "aArg",
     "Should have the right property name for 'aArg'.");
   is(localEnums[1].querySelector(".value").getAttribute("value"), "Object",
     "Should have the right property value for 'aArg'.");
@@ -187,17 +188,18 @@ function testArgumentsProperties() {
       "Should have the right property name for '4'.");
     is(argsEnums[4].querySelector(".value").getAttribute("value"), "null",
       "Should have the right property name for '4'.");
     ok(argsEnums[4].querySelector(".value").className.contains("token-null"),
       "Should have the right token class for '4'.");
 
     is(argsNonEnums[0].querySelector(".name").getAttribute("value"), "callee",
      "Should have the right property name for 'callee'.");
-    is(argsNonEnums[0].querySelector(".value").getAttribute("value"), "Function",
+    is(argsNonEnums[0].querySelector(".value").getAttribute("value"),
+     "test(aArg,bArg,cArg,dArg,eArg,fArg)",
      "Should have the right property name for 'callee'.");
     ok(argsNonEnums[0].querySelector(".value").className.contains("token-other"),
      "Should have the right token class for 'callee'.");
 
     is(argsNonEnums[1].querySelector(".name").getAttribute("value"), "length",
       "Should have the right property name for 'length'.");
     is(argsNonEnums[1].querySelector(".value").getAttribute("value"), "5",
       "Should have the right property value for 'length'.");
@@ -513,24 +515,26 @@ function testGetterSetterObject() {
 
     is(propEnums.length, 0,
       "The propEnums should contain all the created enumerable elements.");
     is(propNonEnums.length, 2,
       "The propEnums should contain all the created non-enumerable elements.");
 
     is(propNonEnums[0].querySelector(".name").getAttribute("value"), "get",
       "Should have the right property name for 'get'.");
-    is(propNonEnums[0].querySelector(".value").getAttribute("value"), "Function",
+    is(propNonEnums[0].querySelector(".value").getAttribute("value"),
+      "test/myVar.prop()",
       "Should have the right property value for 'get'.");
     ok(propNonEnums[0].querySelector(".value").className.contains("token-other"),
       "Should have the right token class for 'get'.");
 
     is(propNonEnums[1].querySelector(".name").getAttribute("value"), "set",
       "Should have the right property name for 'set'.");
-    is(propNonEnums[1].querySelector(".value").getAttribute("value"), "Function",
+    is(propNonEnums[1].querySelector(".value").getAttribute("value"),
+      "test/myVar.prop(val)",
       "Should have the right property value for 'set'.");
     ok(propNonEnums[1].querySelector(".value").className.contains("token-other"),
       "Should have the right token class for 'set'.");
 
     deferred.resolve();
   });
 
   myVar.expand();
diff --git a/browser/devtools/debugger/test/browser_dbg_variables-view-frame-parameters-03.js b/browser/devtools/debugger/test/browser_dbg_variables-view-frame-parameters-03.js
--- a/browser/devtools/debugger/test/browser_dbg_variables-view-frame-parameters-03.js
+++ b/browser/devtools/debugger/test/browser_dbg_variables-view-frame-parameters-03.js
@@ -66,22 +66,24 @@ function testGlobalScope() {
 
   is(globalScope.get("SpecialPowers").target.querySelector(".name").getAttribute("value"), "SpecialPowers",
     "Should have the right property name for 'SpecialPowers'.");
   is(globalScope.get("SpecialPowers").target.querySelector(".value").getAttribute("value"), "Object",
     "Should have the right property value for 'SpecialPowers'.");
 
   is(globalScope.get("window").target.querySelector(".name").getAttribute("value"), "window",
     "Should have the right property name for 'window'.");
-  is(globalScope.get("window").target.querySelector(".value").getAttribute("value"), "Window",
+  is(globalScope.get("window").target.querySelector(".value").getAttribute("value"),
+    "Window \u2192 doc_frame-parameters.html",
     "Should have the right property value for 'window'.");
 
   is(globalScope.get("document").target.querySelector(".name").getAttribute("value"), "document",
     "Should have the right property name for 'document'.");
-  is(globalScope.get("document").target.querySelector(".value").getAttribute("value"), "HTMLDocument",
+  is(globalScope.get("document").target.querySelector(".value").getAttribute("value"),
+    "HTMLDocument \u2192 doc_frame-parameters.html",
     "Should have the right property value for 'document'.");
 
   is(globalScope.get("undefined").target.querySelector(".name").getAttribute("value"), "undefined",
     "Should have the right property name for 'undefined'.");
   is(globalScope.get("undefined").target.querySelector(".value").getAttribute("value"), "undefined",
     "Should have the right property value for 'undefined'.");
 
   is(globalScope.get("undefined").target.querySelector(".enum").childNodes.length, 0,
@@ -118,22 +120,24 @@ function testWindowVariable() {
 
   is(windowVar.get("SpecialPowers").target.querySelector(".name").getAttribute("value"), "SpecialPowers",
     "Should have the right property name for 'SpecialPowers'.");
   is(windowVar.get("SpecialPowers").target.querySelector(".value").getAttribute("value"), "Object",
     "Should have the right property value for 'SpecialPowers'.");
 
   is(windowVar.get("window").target.querySelector(".name").getAttribute("value"), "window",
     "Should have the right property name for 'window'.");
-  is(windowVar.get("window").target.querySelector(".value").getAttribute("value"), "Window",
+  is(windowVar.get("window").target.querySelector(".value").getAttribute("value"),
+    "Window \u2192 doc_frame-parameters.html",
     "Should have the right property value for 'window'.");
 
   is(windowVar.get("document").target.querySelector(".name").getAttribute("value"), "document",
     "Should have the right property name for 'document'.");
-  is(windowVar.get("document").target.querySelector(".value").getAttribute("value"), "HTMLDocument",
+  is(windowVar.get("document").target.querySelector(".value").getAttribute("value"),
+    "HTMLDocument \u2192 doc_frame-parameters.html",
     "Should have the right property value for 'document'.");
 
   is(windowVar.get("undefined").target.querySelector(".name").getAttribute("value"), "undefined",
     "Should have the right property name for 'undefined'.");
   is(windowVar.get("undefined").target.querySelector(".value").getAttribute("value"), "undefined",
     "Should have the right property value for 'undefined'.");
 
   is(windowVar.get("undefined").target.querySelector(".enum").childNodes.length, 0,
diff --git a/browser/devtools/debugger/test/browser_dbg_variables-view-frame-with.js b/browser/devtools/debugger/test/browser_dbg_variables-view-frame-with.js
--- a/browser/devtools/debugger/test/browser_dbg_variables-view-frame-with.js
+++ b/browser/devtools/debugger/test/browser_dbg_variables-view-frame-with.js
@@ -52,17 +52,18 @@ function testFirstWithScope() {
 
   is(withEnums.length, 3,
     "The first 'with' scope should contain all the created enumerable elements.");
   is(withNonEnums.length, 1,
     "The first 'with' scope should contain all the created non-enumerable elements.");
 
   is(withEnums[0].querySelector(".name").getAttribute("value"), "this",
     "Should have the right property name for 'this'.");
-  is(withEnums[0].querySelector(".value").getAttribute("value"), "Window",
+  is(withEnums[0].querySelector(".value").getAttribute("value"),
+    "Window \u2192 doc_with-frame.html",
     "Should have the right property value for 'this'.");
   ok(withEnums[0].querySelector(".value").className.contains("token-other"),
     "Should have the right token class for 'this'.");
 
   is(withEnums[1].querySelector(".name").getAttribute("value"), "one",
     "Should have the right property name for 'one'.");
   is(withEnums[1].querySelector(".value").getAttribute("value"), "1",
     "Should have the right property value for 'one'.");
@@ -126,17 +127,17 @@ function testSecondWithScope() {
     "Should have the right property name for 'PI'.");
   is(secondWithScope.get("PI").target.querySelector(".value").getAttribute("value"), "3.141592653589793",
     "Should have the right property value for 'PI'.");
   ok(secondWithScope.get("PI").target.querySelector(".value").className.contains("token-number"),
     "Should have the right token class for 'PI'.");
 
   is(secondWithScope.get("random").target.querySelector(".name").getAttribute("value"), "random",
     "Should have the right property name for 'random'.");
-  is(secondWithScope.get("random").target.querySelector(".value").getAttribute("value"), "Function",
+  is(secondWithScope.get("random").target.querySelector(".value").getAttribute("value"), "random()",
     "Should have the right property value for 'random'.");
   ok(secondWithScope.get("random").target.querySelector(".value").className.contains("token-other"),
     "Should have the right token class for 'random'.");
 
   is(secondWithScope.get("__proto__").target.querySelector(".name").getAttribute("value"), "__proto__",
     "Should have the right property name for '__proto__'.");
   is(secondWithScope.get("__proto__").target.querySelector(".value").getAttribute("value"), "Object",
     "Should have the right property value for '__proto__'.");
diff --git a/browser/devtools/debugger/test/browser_dbg_variables-view-large-array-buffer.js b/browser/devtools/debugger/test/browser_dbg_variables-view-large-array-buffer.js
--- a/browser/devtools/debugger/test/browser_dbg_variables-view-large-array-buffer.js
+++ b/browser/devtools/debugger/test/browser_dbg_variables-view-large-array-buffer.js
@@ -60,17 +60,17 @@ function performTest() {
     "Should have the right property name for 'buffer'.");
   is(bufferVar.target.querySelector(".value").getAttribute("value"), "ArrayBuffer",
     "Should have the right property value for 'buffer'.");
   ok(bufferVar.target.querySelector(".value").className.contains("token-other"),
     "Should have the right token class for 'buffer'.");
 
   is(zVar.target.querySelector(".name").getAttribute("value"), "z",
     "Should have the right property name for 'z'.");
-  is(zVar.target.querySelector(".value").getAttribute("value"), "Int8Array",
+  is(zVar.target.querySelector(".value").getAttribute("value"), "Int8Array[10000]",
     "Should have the right property value for 'z'.");
   ok(zVar.target.querySelector(".value").className.contains("token-other"),
     "Should have the right token class for 'z'.");
 
   EventUtils.sendMouseEvent({ type: "mousedown" },
     bufferVar.target.querySelector(".arrow"),
     gDebugger);
 
diff --git a/browser/devtools/debugger/test/browser_dbg_variables-view-webidl.js b/browser/devtools/debugger/test/browser_dbg_variables-view-webidl.js
--- a/browser/devtools/debugger/test/browser_dbg_variables-view-webidl.js
+++ b/browser/devtools/debugger/test/browser_dbg_variables-view-webidl.js
@@ -57,31 +57,32 @@ function performTest() {
   let globalScope = gVariables.getScopeAtIndex(1);
 
   let buttonVar = globalScope.get("button");
   let buttonAsProtoVar = globalScope.get("buttonAsProto");
   let documentVar = globalScope.get("document");
 
   is(buttonVar.target.querySelector(".name").getAttribute("value"), "button",
     "Should have the right property name for 'button'.");
-  is(buttonVar.target.querySelector(".value").getAttribute("value"), "HTMLButtonElement",
+  is(buttonVar.target.querySelector(".value").getAttribute("value"), "<button>",
     "Should have the right property value for 'button'.");
   ok(buttonVar.target.querySelector(".value").className.contains("token-other"),
     "Should have the right token class for 'button'.");
 
   is(buttonAsProtoVar.target.querySelector(".name").getAttribute("value"), "buttonAsProto",
     "Should have the right property name for 'buttonAsProto'.");
   is(buttonAsProtoVar.target.querySelector(".value").getAttribute("value"), "Object",
     "Should have the right property value for 'buttonAsProto'.");
   ok(buttonAsProtoVar.target.querySelector(".value").className.contains("token-other"),
     "Should have the right token class for 'buttonAsProto'.");
 
   is(documentVar.target.querySelector(".name").getAttribute("value"), "document",
     "Should have the right property name for 'document'.");
-  is(documentVar.target.querySelector(".value").getAttribute("value"), "HTMLDocument",
+  is(documentVar.target.querySelector(".value").getAttribute("value"),
+    "HTMLDocument \u2192 doc_frame-parameters.html",
     "Should have the right property value for 'document'.");
   ok(documentVar.target.querySelector(".value").className.contains("token-other"),
     "Should have the right token class for 'document'.");
 
   is(buttonVar.expanded, false,
     "The buttonVar should not be expanded at this point.");
   is(buttonAsProtoVar.expanded, false,
     "The buttonAsProtoVar should not be expanded at this point.");
@@ -93,38 +94,38 @@ function performTest() {
       "Should have the right property name for 'type'.");
     is(buttonVar.get("type").target.querySelector(".value").getAttribute("value"), "\"submit\"",
       "Should have the right property value for 'type'.");
     ok(buttonVar.get("type").target.querySelector(".value").className.contains("token-string"),
       "Should have the right token class for 'type'.");
 
     is(buttonVar.get("childNodes").target.querySelector(".name").getAttribute("value"), "childNodes",
       "Should have the right property name for 'childNodes'.");
-    is(buttonVar.get("childNodes").target.querySelector(".value").getAttribute("value"), "NodeList",
+    is(buttonVar.get("childNodes").target.querySelector(".value").getAttribute("value"), "NodeList[1]",
       "Should have the right property value for 'childNodes'.");
     ok(buttonVar.get("childNodes").target.querySelector(".value").className.contains("token-other"),
       "Should have the right token class for 'childNodes'.");
 
     is(buttonVar.get("onclick").target.querySelector(".name").getAttribute("value"), "onclick",
       "Should have the right property name for 'onclick'.");
-    is(buttonVar.get("onclick").target.querySelector(".value").getAttribute("value"), "Function",
+    is(buttonVar.get("onclick").target.querySelector(".value").getAttribute("value"), "onclick(event)",
       "Should have the right property value for 'onclick'.");
     ok(buttonVar.get("onclick").target.querySelector(".value").className.contains("token-other"),
       "Should have the right token class for 'onclick'.");
 
     is(documentVar.get("title").target.querySelector(".name").getAttribute("value"), "title",
       "Should have the right property name for 'title'.");
     is(documentVar.get("title").target.querySelector(".value").getAttribute("value"), "\"Debugger test page\"",
       "Should have the right property value for 'title'.");
     ok(documentVar.get("title").target.querySelector(".value").className.contains("token-string"),
       "Should have the right token class for 'title'.");
 
     is(documentVar.get("childNodes").target.querySelector(".name").getAttribute("value"), "childNodes",
       "Should have the right property name for 'childNodes'.");
-    is(documentVar.get("childNodes").target.querySelector(".value").getAttribute("value"), "NodeList",
+    is(documentVar.get("childNodes").target.querySelector(".value").getAttribute("value"), "NodeList[3]",
       "Should have the right property value for 'childNodes'.");
     ok(documentVar.get("childNodes").target.querySelector(".value").className.contains("token-other"),
       "Should have the right token class for 'childNodes'.");
 
     is(documentVar.get("onclick").target.querySelector(".name").getAttribute("value"), "onclick",
       "Should have the right property name for 'onclick'.");
     is(documentVar.get("onclick").target.querySelector(".value").getAttribute("value"), "null",
       "Should have the right property value for 'onclick'.");
@@ -139,17 +140,17 @@ function performTest() {
       "Should have the right property name for '__proto__'.");
     is(buttonProtoVar.target.querySelector(".value").getAttribute("value"), "HTMLButtonElementPrototype",
       "Should have the right property value for '__proto__'.");
     ok(buttonProtoVar.target.querySelector(".value").className.contains("token-other"),
       "Should have the right token class for '__proto__'.");
 
     is(buttonAsProtoProtoVar.target.querySelector(".name").getAttribute("value"), "__proto__",
       "Should have the right property name for '__proto__'.");
-    is(buttonAsProtoProtoVar.target.querySelector(".value").getAttribute("value"), "HTMLButtonElement",
+    is(buttonAsProtoProtoVar.target.querySelector(".value").getAttribute("value"), "<button>",
       "Should have the right property value for '__proto__'.");
     ok(buttonAsProtoProtoVar.target.querySelector(".value").className.contains("token-other"),
       "Should have the right token class for '__proto__'.");
 
     is(documentProtoVar.target.querySelector(".name").getAttribute("value"), "__proto__",
       "Should have the right property name for '__proto__'.");
     is(documentProtoVar.target.querySelector(".value").getAttribute("value"), "HTMLDocumentPrototype",
       "Should have the right property value for '__proto__'.");
@@ -168,24 +169,24 @@ function performTest() {
         "Should have the right property name for 'type'.");
       is(buttonAsProtoProtoVar.get("type").target.querySelector(".value").getAttribute("value"), "\"submit\"",
         "Should have the right property value for 'type'.");
       ok(buttonAsProtoProtoVar.get("type").target.querySelector(".value").className.contains("token-string"),
         "Should have the right token class for 'type'.");
 
       is(buttonAsProtoProtoVar.get("childNodes").target.querySelector(".name").getAttribute("value"), "childNodes",
         "Should have the right property name for 'childNodes'.");
-      is(buttonAsProtoProtoVar.get("childNodes").target.querySelector(".value").getAttribute("value"), "NodeList",
+      is(buttonAsProtoProtoVar.get("childNodes").target.querySelector(".value").getAttribute("value"), "NodeList[1]",
         "Should have the right property value for 'childNodes'.");
       ok(buttonAsProtoProtoVar.get("childNodes").target.querySelector(".value").className.contains("token-other"),
         "Should have the right token class for 'childNodes'.");
 
       is(buttonAsProtoProtoVar.get("onclick").target.querySelector(".name").getAttribute("value"), "onclick",
         "Should have the right property name for 'onclick'.");
-      is(buttonAsProtoProtoVar.get("onclick").target.querySelector(".value").getAttribute("value"), "Function",
+      is(buttonAsProtoProtoVar.get("onclick").target.querySelector(".value").getAttribute("value"), "onclick(event)",
         "Should have the right property value for 'onclick'.");
       ok(buttonAsProtoProtoVar.get("onclick").target.querySelector(".value").className.contains("token-other"),
         "Should have the right token class for 'onclick'.");
 
       let buttonProtoProtoVar = buttonProtoVar.get("__proto__");
       let buttonAsProtoProtoProtoVar = buttonAsProtoProtoVar.get("__proto__");
       let documentProtoProtoVar = documentProtoVar.get("__proto__");
 
diff --git a/browser/devtools/webconsole/test/browser.ini b/browser/devtools/webconsole/test/browser.ini
--- a/browser/devtools/webconsole/test/browser.ini
+++ b/browser/devtools/webconsole/test/browser.ini
@@ -59,16 +59,17 @@ support-files =
   test-bug-859170-longstring-hang.html
   test-bug-869003-iframe.html
   test-bug-869003-top-window.html
   test-closures.html
   test-console-assert.html
   test-console-extras.html
   test-console-replaced-api.html
   test-console.html
+  test-console-output.html
   test-consoleiframes.html
   test-data.json
   test-data.json^headers^
   test-duplicate-error.html
   test-encoding-ISO-8859-1.html
   test-error.html
   test-eval-in-stackframe.html
   test-file-location.js
@@ -162,17 +163,16 @@ support-files =
 [browser_webconsole_bug_595223_file_uri.js]
 [browser_webconsole_bug_595350_multiple_windows_and_tabs.js]
 [browser_webconsole_bug_595934_message_categories.js]
 [browser_webconsole_bug_597103_deactivateHUDForContext_unfocused_window.js]
 [browser_webconsole_bug_597136_external_script_errors.js]
 [browser_webconsole_bug_597136_network_requests_from_chrome.js]
 [browser_webconsole_bug_597460_filter_scroll.js]
 [browser_webconsole_bug_597756_reopen_closed_tab.js]
-[browser_webconsole_bug_598357_jsterm_output.js]
 [browser_webconsole_bug_599725_response_headers.js]
 [browser_webconsole_bug_600183_charset.js]
 [browser_webconsole_bug_601177_log_levels.js]
 [browser_webconsole_bug_601352_scroll.js]
 [browser_webconsole_bug_601667_filter_buttons.js]
 [browser_webconsole_bug_602572_log_bodies_checkbox.js]
 [browser_webconsole_bug_603750_websocket.js]
 [browser_webconsole_bug_611795.js]
@@ -243,8 +243,13 @@ run-if = os == "mac"
 [browser_webconsole_scratchpad_panel_link.js]
 [browser_webconsole_split.js]
 [browser_webconsole_view_source.js]
 [browser_webconsole_reflow.js]
 [browser_webconsole_log_file_filter.js]
 [browser_webconsole_expandable_timestamps.js]
 [browser_webconsole_autocomplete_in_debugger_stackframe.js]
 [browser_webconsole_autocomplete_popup_close_on_tab_switch.js]
+[browser_webconsole_output_01.js]
+[browser_webconsole_output_02.js]
+[browser_webconsole_output_03.js]
+[browser_webconsole_output_04.js]
+[browser_webconsole_output_events.js]
diff --git a/browser/devtools/webconsole/test/browser_bug_865871_variables_view_close_on_esc_key.js b/browser/devtools/webconsole/test/browser_bug_865871_variables_view_close_on_esc_key.js
--- a/browser/devtools/webconsole/test/browser_bug_865871_variables_view_close_on_esc_key.js
+++ b/browser/devtools/webconsole/test/browser_bug_865871_variables_view_close_on_esc_key.js
@@ -31,17 +31,18 @@ function consoleOpened(hud)
 }
 
 function onExecuteFooObj(msg)
 {
   ok(msg, "output message found");
 
   let anchor = msg.querySelector("a");
   ok(anchor, "object anchor");
-  isnot(anchor.textContent.indexOf("[object Object]"), -1, "message text check");
+  isnot(anchor.textContent.indexOf('testProp: "testValue"'), -1,
+        "message text check");
 
   gJSTerm.once("variablesview-fetched", onFooObjFetch);
   EventUtils.synthesizeMouse(anchor, 2, 2, {}, gWebConsole.iframeWindow)
 }
 
 function onFooObjFetch(aEvent, aVar)
 {
   gVariablesView = aVar._variablesView;
@@ -71,17 +72,18 @@ function onSidebarClosed()
   gJSTerm.execute("window", onExecuteWindow);
 }
 
 function onExecuteWindow(msg)
 {
   ok(msg, "output message found");
   let anchor = msg.querySelector("a");
   ok(anchor, "object anchor");
-  isnot(anchor.textContent.indexOf("[object Window]"), -1, "message text check");
+  isnot(anchor.textContent.indexOf("Window \u2192 http://example.com/browser/"), -1,
+        "message text check");
 
   gJSTerm.once("variablesview-fetched", onWindowFetch);
   EventUtils.synthesizeMouse(anchor, 2, 2, {}, gWebConsole.iframeWindow)
 }
 
 function onWindowFetch(aEvent, aVar)
 {
   gVariablesView = aVar._variablesView;
diff --git a/browser/devtools/webconsole/test/browser_bug_869003_inspect_cross_domain_object.js b/browser/devtools/webconsole/test/browser_bug_869003_inspect_cross_domain_object.js
--- a/browser/devtools/webconsole/test/browser_bug_869003_inspect_cross_domain_object.js
+++ b/browser/devtools/webconsole/test/browser_bug_869003_inspect_cross_domain_object.js
@@ -41,17 +41,17 @@ function consoleOpened(hud)
     }],
   }).then(onConsoleMessage);
 }
 
 function onConsoleMessage(aResults)
 {
   let clickable = aResults[0].clickableElements[0];
   ok(clickable, "clickable object found");
-  isnot(clickable.textContent.indexOf("[object Object]"), -1,
+  isnot(clickable.textContent.indexOf('{hello: "world!",'), -1,
         "message text check");
 
   gJSTerm.once("variablesview-fetched", onObjFetch);
 
   EventUtils.synthesizeMouse(clickable, 2, 2, {}, gWebConsole.iframeWindow)
 }
 
 function onObjFetch(aEvent, aVar)
diff --git a/browser/devtools/webconsole/test/browser_console_consolejsm_output.js b/browser/devtools/webconsole/test/browser_console_consolejsm_output.js
--- a/browser/devtools/webconsole/test/browser_console_consolejsm_output.js
+++ b/browser/devtools/webconsole/test/browser_console_consolejsm_output.js
@@ -66,17 +66,17 @@ function test()
         {
           name: "console.warn output",
           text: "bug851231-warn",
           category: CATEGORY_WEBDEV,
           severity: SEVERITY_WARNING,
         },
         {
           name: "console.error output",
-          text: /\bbug851231-error\b.+\[object Object\]/,
+          text: /\bbug851231-error\b.+\{bug851231prop:\s"bug851231value"\}/,
           category: CATEGORY_WEBDEV,
           severity: SEVERITY_ERROR,
           objects: true,
         },
         {
           name: "console.debug output",
           text: "bug851231-debug",
           category: CATEGORY_WEBDEV,
@@ -86,17 +86,17 @@ function test()
           name: "console.trace output",
           consoleTrace: {
             file: "browser_console_consolejsm_output.js",
             fn: "onCachedMessage",
           },
         },
         {
           name: "console.dir output",
-          consoleDir: "[object XULDocument]",
+          consoleDir: "XULDocument {",
         },
         {
           name: "console.time output",
           consoleTime: "foobarTimer",
         },
         {
           name: "console.timeEnd output",
           consoleTimeEnd: "foobarTimer",
diff --git a/browser/devtools/webconsole/test/browser_console_log_inspectable_object.js b/browser/devtools/webconsole/test/browser_console_log_inspectable_object.js
--- a/browser/devtools/webconsole/test/browser_console_log_inspectable_object.js
+++ b/browser/devtools/webconsole/test/browser_console_log_inspectable_object.js
@@ -29,17 +29,17 @@ function performTest(hud)
       text: "fooBug676722",
       category: CATEGORY_WEBDEV,
       severity: SEVERITY_LOG,
       objects: true,
     }],
   }).then(([result]) => {
     let clickable = result.clickableElements[0];
     ok(clickable, "the console.log() object anchor was found");
-    isnot(clickable.textContent.indexOf("Object"), -1,
+    isnot(clickable.textContent.indexOf('{abba: "omgBug676722"}'), -1,
           "clickable node content is correct");
 
     hud.jsterm.once("variablesview-fetched",
       (aEvent, aVar) => {
         ok(aVar, "object inspector opened on click");
 
         findVariableViewProperties(aVar, [{
           name: "abba",
diff --git a/browser/devtools/webconsole/test/browser_console_native_getters.js b/browser/devtools/webconsole/test/browser_console_native_getters.js
--- a/browser/devtools/webconsole/test/browser_console_native_getters.js
+++ b/browser/devtools/webconsole/test/browser_console_native_getters.js
@@ -25,17 +25,17 @@ function consoleOpened(hud)
   gWebConsole = hud;
   gJSTerm = hud.jsterm;
 
   gJSTerm.execute("document");
 
   waitForMessages({
     webconsole: hud,
     messages: [{
-      text: "[object HTMLDocument]",
+      text: "HTMLDocument \u2192 data:text/html;charset=utf8",
       category: CATEGORY_OUTPUT,
       objects: true,
     }],
   }).then(onEvalResult);
 }
 
 function onEvalResult(aResults)
 {
@@ -85,17 +85,17 @@ function onFetchAfterBackgroundUpdate(aE
 
 function testParagraphs()
 {
   gJSTerm.execute("$$('p')");
 
   waitForMessages({
     webconsole: gWebConsole,
     messages: [{
-      text: "[object NodeList]",
+      text: "NodeList [",
       category: CATEGORY_OUTPUT,
       objects: true,
     }],
   }).then(onEvalNodeList);
 }
 
 function onEvalNodeList(aResults)
 {
diff --git a/browser/devtools/webconsole/test/browser_console_variables_view.js b/browser/devtools/webconsole/test/browser_console_variables_view.js
--- a/browser/devtools/webconsole/test/browser_console_variables_view.js
+++ b/browser/devtools/webconsole/test/browser_console_variables_view.js
@@ -23,17 +23,18 @@ function consoleOpened(hud)
   gWebConsole = hud;
   gJSTerm = hud.jsterm;
   gJSTerm.execute("fooObj", onExecuteFooObj);
 }
 
 function onExecuteFooObj(msg)
 {
   ok(msg, "output message found");
-  isnot(msg.textContent.indexOf("[object Object]"), -1, "message text check");
+  isnot(msg.textContent.indexOf('{testProp: "testValue"}'), -1,
+        "message text check");
 
   let anchor = msg.querySelector("a");
   ok(anchor, "object link found");
 
   gJSTerm.once("variablesview-fetched", onFooObjFetch);
 
   executeSoon(() =>
     EventUtils.synthesizeMouse(anchor, 2, 2, {}, gWebConsole.iframeWindow)
diff --git a/browser/devtools/webconsole/test/browser_console_variables_view_while_debugging.js b/browser/devtools/webconsole/test/browser_console_variables_view_while_debugging.js
--- a/browser/devtools/webconsole/test/browser_console_variables_view_while_debugging.js
+++ b/browser/devtools/webconsole/test/browser_console_variables_view_while_debugging.js
@@ -57,17 +57,18 @@ function onFramesAdded()
     )
   );
 }
 
 
 function onExecuteFooObj(msg)
 {
   ok(msg, "output message found");
-  isnot(msg.textContent.indexOf("[object Object]"), -1, "message text check");
+  isnot(msg.textContent.indexOf('{testProp2: "testValue2"}'), -1,
+        "message text check");
 
   let anchor = msg.querySelector("a");
   ok(anchor, "object link found");
 
   gJSTerm.once("variablesview-fetched", onFooObjFetch);
 
   executeSoon(() => EventUtils.synthesizeMouse(anchor, 2, 2, {},
                                                gWebConsole.iframeWindow));
diff --git a/browser/devtools/webconsole/test/browser_console_variables_view_while_debugging_and_inspecting.js b/browser/devtools/webconsole/test/browser_console_variables_view_while_debugging_and_inspecting.js
--- a/browser/devtools/webconsole/test/browser_console_variables_view_while_debugging_and_inspecting.js
+++ b/browser/devtools/webconsole/test/browser_console_variables_view_while_debugging_and_inspecting.js
@@ -52,17 +52,18 @@ function onFramesAdded()
   info("onFramesAdded");
 
   openConsole(null, () => gJSTerm.execute("fooObj", onExecuteFooObj));
 }
 
 function onExecuteFooObj(msg)
 {
   ok(msg, "output message found");
-  isnot(msg.textContent.indexOf("[object Object]"), -1, "message text check");
+  isnot(msg.textContent.indexOf('{testProp2: "testValue2"}'), -1,
+        "message text check");
 
   let anchor = msg.querySelector("a");
   ok(anchor, "object link found");
 
   gJSTerm.once("variablesview-fetched", onFooObjFetch);
 
   EventUtils.synthesizeMouse(anchor, 2, 2, {}, gWebConsole.iframeWindow);
 }
diff --git a/browser/devtools/webconsole/test/browser_jsterm_inspect.js b/browser/devtools/webconsole/test/browser_jsterm_inspect.js
--- a/browser/devtools/webconsole/test/browser_jsterm_inspect.js
+++ b/browser/devtools/webconsole/test/browser_jsterm_inspect.js
@@ -24,12 +24,12 @@ function test()
   }
 
   function onObjFetch(aEvent, aVar)
   {
     ok(aVar._variablesView, "variables view object");
 
     findVariableViewProperties(aVar, [
       { name: "testProp", value: "testValue" },
-      { name: "document", value: "HTMLDocument" },
+      { name: "document", value: /HTMLDocument \u2192 data:/ },
     ], { webconsole: hud }).then(finishTest);
   }
 }
diff --git a/browser/devtools/webconsole/test/browser_result_format_as_string.js b/browser/devtools/webconsole/test/browser_result_format_as_string.js
--- a/browser/devtools/webconsole/test/browser_result_format_as_string.js
+++ b/browser/devtools/webconsole/test/browser_result_format_as_string.js
@@ -23,19 +23,19 @@ function performTest(hud)
   hud.jsterm.clearOutput(true);
 
   hud.jsterm.execute("document.querySelector('p')", (msg) => {
     is(hud.outputNode.textContent.indexOf("bug772506_content"), -1,
        "no content element found");
     ok(!hud.outputNode.querySelector("#foobar"), "no #foobar element found");
 
     ok(msg, "eval output node found");
-    is(msg.textContent.indexOf("HTMLDivElement"), -1,
-       "HTMLDivElement string is not displayed");
-    isnot(msg.textContent.indexOf("HTMLParagraphElement"), -1,
-          "HTMLParagraphElement string is displayed");
+    is(msg.textContent.indexOf("<div>"), -1,
+       "<div> string is not displayed");
+    isnot(msg.textContent.indexOf("<p>"), -1,
+          "<p> string is displayed");
 
     EventUtils.synthesizeMouseAtCenter(msg, {type: "mousemove"});
     ok(!gBrowser._bug772506, "no content variable");
 
     finishTest();
   });
 }
diff --git a/browser/devtools/webconsole/test/browser_webconsole_bug_597103_deactivateHUDForContext_unfocused_window.js b/browser/devtools/webconsole/test/browser_webconsole_bug_597103_deactivateHUDForContext_unfocused_window.js
--- a/browser/devtools/webconsole/test/browser_webconsole_bug_597103_deactivateHUDForContext_unfocused_window.js
+++ b/browser/devtools/webconsole/test/browser_webconsole_bug_597103_deactivateHUDForContext_unfocused_window.js
@@ -75,19 +75,18 @@ function tab2Loaded(aEvent) {
       ok(false, "gDevTools.closeToolbox(target1) exception: " + ex);
       noErrors = false;
     }
   }
 
   function testEnd() {
     ok(noErrors, "there were no errors");
 
-    Array.forEach(win1.gBrowser.tabs, function(aTab) {
-      win1.gBrowser.removeTab(aTab);
-    });
+    win1.gBrowser.removeTab(tab1);
+
     Array.forEach(win2.gBrowser.tabs, function(aTab) {
       win2.gBrowser.removeTab(aTab);
     });
 
     executeSoon(function() {
       win2.close();
       tab1 = tab2 = win1 = win2 = null;
       finishTest();
diff --git a/browser/devtools/webconsole/test/browser_webconsole_bug_651501_document_body_autocomplete.js b/browser/devtools/webconsole/test/browser_webconsole_bug_651501_document_body_autocomplete.js
--- a/browser/devtools/webconsole/test/browser_webconsole_bug_651501_document_body_autocomplete.js
+++ b/browser/devtools/webconsole/test/browser_webconsole_bug_651501_document_body_autocomplete.js
@@ -52,42 +52,37 @@ function autocompletePopupHidden()
   let jsterm = gHUD.jsterm;
   let popup = jsterm.autocompletePopup;
   let completeNode = jsterm.completeNode;
   let inputNode = jsterm.inputNode;
 
   popup._panel.removeEventListener("popuphidden", autocompletePopupHidden, false);
 
   ok(!popup.isOpen, "popup is not open");
+
+  jsterm.once("autocomplete-updated", function() {
+    is(completeNode.value, testStr + "dy", "autocomplete shows document.body");
+    testPropertyPanel();
+  });
+
   let inputStr = "document.b";
   jsterm.setInputValue(inputStr);
   EventUtils.synthesizeKey("o", {});
   let testStr = inputStr.replace(/./g, " ") + " ";
-
-  waitForSuccess({
-    name: "autocomplete shows document.body",
-    validatorFn: function()
-    {
-      return completeNode.value == testStr + "dy";
-    },
-    successFn: testPropertyPanel,
-    failureFn: finishTest,
-  });
 }
 
 function testPropertyPanel()
 {
   let jsterm = gHUD.jsterm;
   jsterm.clearOutput();
   jsterm.execute("document", (msg) => {
     jsterm.once("variablesview-fetched", onVariablesViewReady);
     let anchor = msg.querySelector(".body a");
     EventUtils.synthesizeMouse(anchor, 2, 2, {}, gHUD.iframeWindow);
   });
 }
 
 function onVariablesViewReady(aEvent, aView)
 {
   findVariableViewProperties(aView, [
-    { name: "body", value: "HTMLBodyElement" },
+    { name: "body", value: "<body>" },
   ], { webconsole: gHUD }).then(finishTest);
 }
-
diff --git a/browser/devtools/webconsole/test/browser_webconsole_bug_653531_highlighter_console_helper.js b/browser/devtools/webconsole/test/browser_webconsole_bug_653531_highlighter_console_helper.js
--- a/browser/devtools/webconsole/test/browser_webconsole_bug_653531_highlighter_console_helper.js
+++ b/browser/devtools/webconsole/test/browser_webconsole_bug_653531_highlighter_console_helper.js
@@ -83,18 +83,17 @@ function performWebConsoleTests(hud)
   let jsterm = hud.jsterm;
   outputNode = hud.outputNode;
 
   jsterm.clearOutput();
   jsterm.execute("$0", onNodeOutput);
 
   function onNodeOutput(node)
   {
-    isnot(node.textContent.indexOf("[object HTMLHeadingElement"), -1,
-          "correct output for $0");
+    isnot(node.textContent.indexOf("<h1>"), -1, "correct output for $0");
 
     jsterm.clearOutput();
     jsterm.execute("$0.textContent = 'bug653531'", onNodeUpdate);
   }
 
   function onNodeUpdate(node)
   {
     isnot(node.textContent.indexOf("bug653531"), -1,
diff --git a/browser/devtools/webconsole/test/browser_webconsole_bug_659907_console_dir.js b/browser/devtools/webconsole/test/browser_webconsole_bug_659907_console_dir.js
--- a/browser/devtools/webconsole/test/browser_webconsole_bug_659907_console_dir.js
+++ b/browser/devtools/webconsole/test/browser_webconsole_bug_659907_console_dir.js
@@ -17,13 +17,13 @@ function test() {
 
 function consoleOpened(hud) {
   hud.jsterm.execute("console.dir(document)");
   hud.jsterm.once("variablesview-fetched", testConsoleDir.bind(null, hud));
 }
 
 function testConsoleDir(hud, ev, view) {
   findVariableViewProperties(view, [
-    { name: "__proto__.__proto__.querySelectorAll", value: "Function" },
-    { name: "location", value: "Location" },
-    { name: "__proto__.write", value: "Function" },
+    { name: "__proto__.__proto__.querySelectorAll", value: "querySelectorAll()" },
+    { name: "location", value: /Location \u2192 data:Web/ },
+    { name: "__proto__.write", value: "write()" },
   ], { webconsole: hud }).then(finishTest);
 }
diff --git a/browser/devtools/webconsole/test/browser_webconsole_closure_inspection.js b/browser/devtools/webconsole/test/browser_webconsole_closure_inspection.js
--- a/browser/devtools/webconsole/test/browser_webconsole_closure_inspection.js
+++ b/browser/devtools/webconsole/test/browser_webconsole_closure_inspection.js
@@ -49,17 +49,17 @@ function consoleOpened(hud)
 {
   gWebConsole = hud;
   gJSTerm = hud.jsterm;
   gJSTerm.execute("window.george.getName");
 
   waitForMessages({
     webconsole: gWebConsole,
     messages: [{
-      text: "[object Function]",
+      text: "function _pfactory/<.getName()",
       category: CATEGORY_OUTPUT,
       objects: true,
     }],
   }).then(onExecuteGetName);
 }
 
 function onExecuteGetName(aResults)
 {
diff --git a/browser/devtools/webconsole/test/browser_webconsole_jsterm.js b/browser/devtools/webconsole/test/browser_webconsole_jsterm.js
--- a/browser/devtools/webconsole/test/browser_webconsole_jsterm.js
+++ b/browser/devtools/webconsole/test/browser_webconsole_jsterm.js
@@ -113,17 +113,17 @@ function testJSTerm(hud)
 
   let output = jsterm.outputNode.querySelector(".message[category='output']");
   ok(!output, "no output for help() calls");
   is(openedLinks, 3, "correct number of pages opened by the help calls");
   hud.openLink = oldOpenLink;
 
   jsterm.clearOutput();
   jsterm.execute("pprint({b:2, a:1})");
-  checkResult('"  b: 2\n  a: 1"', "pprint()");
+  checkResult("\"  b: 2\\n  a: 1\"", "pprint()");
   yield undefined;
 
   // check instanceof correctness, bug 599940
   jsterm.clearOutput();
   jsterm.execute("[] instanceof Array");
   checkResult("true", "[] instanceof Array == true");
   yield undefined;
 
@@ -149,17 +149,17 @@ function testJSTerm(hud)
   jsterm.clearOutput();
   jsterm.execute("keys(window)");
   checkResult(null, "keys(window)");
   yield undefined;
 
   // bug 614561
   jsterm.clearOutput();
   jsterm.execute("pprint('hi')");
-  checkResult('"  0: "h"\n  1: "i""', "pprint('hi')");
+  checkResult("\"  0: \\\"h\\\"\\n  1: \\\"i\\\"\"", "pprint('hi')");
   yield undefined;
 
   // check that pprint(function) shows function source, bug 618344
   jsterm.clearOutput();
   jsterm.execute("pprint(print)");
   checkResult(function(node) {
     return node.textContent.indexOf("aOwner.helperResult") > -1;
   }, "pprint(function) shows source");
diff --git a/browser/devtools/webconsole/test/browser_webconsole_bug_598357_jsterm_output.js b/browser/devtools/webconsole/test/browser_webconsole_output_01.js
rename from browser/devtools/webconsole/test/browser_webconsole_bug_598357_jsterm_output.js
rename to browser/devtools/webconsole/test/browser_webconsole_output_01.js
--- a/browser/devtools/webconsole/test/browser_webconsole_bug_598357_jsterm_output.js
+++ b/browser/devtools/webconsole/test/browser_webconsole_output_01.js
@@ -1,267 +1,256 @@
-/* vim:set ts=2 sw=2 sts=2 et: */
-/* ***** BEGIN LICENSE BLOCK *****
+/*
  * Any copyright is dedicated to the Public Domain.
  * http://creativecommons.org/publicdomain/zero/1.0/
- *
- * Contributor(s):
- *  Mihai ucan <mihai.sucan@gmail.com>
- *
- * ***** END LICENSE BLOCK ***** */
+ */
 
-const TEST_URI = "http://example.com/browser/browser/devtools/webconsole/test/test-console.html";
+// Test the webconsole output for various types of objects.
 
-let testEnded = false;
-let pos = -1;
+const TEST_URI = "data:text/html;charset=utf8,test for console output";
 
 let dateNow = Date.now();
+let DebuggerServer = Cu.import("resource://gre/modules/devtools/dbg-server.jsm", {}).DebuggerServer;
+let longString = (new Array(DebuggerServer.LONG_STRING_LENGTH + 4)).join("a");
+let initialString = longString.substring(0, DebuggerServer.LONG_STRING_INITIAL_LENGTH);
+DebuggerServer = null;
 
-let tempScope = {};
-Cu.import("resource://gre/modules/devtools/dbg-server.jsm", tempScope);
+// Each input test object has the following properties:
+//
+// - input: string, JS input value to execute.
+//
+// - output: string|RegExp, expected JS eval result.
+//
+// - inspectable: boolean, tells if the result is expected to be an object you
+// can click on to inspect.
+//
+// - printOutput: string|RegExp, optional, expected output for |print(input)|.
+// If this is not provided, printOutput = output.
+//
+// - variablesViewLabel: string|RegExp, optional, the expected variables view label
+// when the object is inspected. If this is not provided, then |output| is used.
 
-let longString = (new Array(tempScope.DebuggerServer.LONG_STRING_LENGTH + 4)).join("a");
-let initialString = longString.substring(0,
-  tempScope.DebuggerServer.LONG_STRING_INITIAL_LENGTH);
-
-let inputValues = [
-  // [showsVariablesView?, input value, expected output format,
-  //    print() output, console API output, optional console API test]
-
+let inputTests = [
   // 0
-  [false, "'hello \\nfrom \\rthe \\\"string world!'",
-    '"hello \nfrom \rthe "string world!"',
-    "hello \nfrom \rthe \"string world!"],
+  {
+    input: "'hello \\nfrom \\rthe \\\"string world!'",
+    output: "\"hello \\nfrom \\rthe \\\"string world!\"",
+  },
 
   // 1
-  [false, "'\xFA\u1E47\u0129\xE7\xF6d\xEA \u021B\u0115\u0219\u0165'",
-    "\"\xFA\u1E47\u0129\xE7\xF6d\xEA \u021B\u0115\u0219\u0165\"",
-    "\xFA\u1E47\u0129\xE7\xF6d\xEA \u021B\u0115\u0219\u0165"],
+  {
+    // unicode test
+    input: "'\xFA\u1E47\u0129\xE7\xF6d\xEA \u021B\u0115\u0219\u0165'",
+    output: "\"\\xFA\\u1E47\\u0129\\xE7\\xF6d\\xEA \\u021B\\u0115\\u0219\\u0165\"",
+  },
 
   // 2
-  [false, "window.location.href", '"' + TEST_URI + '"', TEST_URI],
+  {
+    input: "'" + longString + "'",
+    output: '"' + initialString + "\"[\u2026]",
+    printOutput: initialString,
+  },
 
   // 3
-  [false, "0", "0"],
+  {
+    input: "''",
+    output: '""',
+    printOutput: '""',
+  },
 
   // 4
-  [false, "'0'", '"0"', "0"],
+  {
+    input: "0",
+    output: "0",
+  },
 
   // 5
-  [false, "42", "42"],
+  {
+    input: "'0'",
+    output: '"0"',
+  },
 
   // 6
-  [false, "'42'", '"42"', "42"],
+  {
+    input: "42",
+    output: "42",
+  },
 
   // 7
-  [true, "/foobar/", "[object RegExp]", '"/foobar/"', "[object RegExp]"],
+  {
+    input: "'42'",
+    output: '"42"',
+  },
 
   // 8
-  [false, "null", "null"],
+  {
+    input: "/foobar/",
+    output: "/foobar/",
+    inspectable: true,
+  },
 
   // 9
-  [false, "undefined", "undefined"],
+  {
+    input: "/foo?b*\\s\"ar/igym",
+    output: "/foo?b*\\s\"ar/gimy",
+    printOutput: "/foo?b*\\\\s\\\"ar/gimy",
+    inspectable: true,
+  },
 
   // 10
-  [false, "true", "true"],
+  {
+    input: "null",
+    output: "null",
+  },
 
   // 11
-  [true, "document.getElementById", "[object Function]",
-    "function getElementById() {\n    [native code]\n}",
-    "[object Function]"],
+  {
+    input: "undefined",
+    output: "undefined",
+  },
 
   // 12
-  [true, "(function() { return 42; })", "[object Function]",
-    "function () { return 42; }", "[object Function]"],
+  {
+    input: "true",
+    output: "true",
+  },
 
   // 13
-  [true, "new Date(" + dateNow + ")", "[object Date]", (new Date(dateNow)).toString(), "[object Date]"],
+  {
+    input: "false",
+    output: "false",
+  },
+
 
   // 14
-  [true, "document.body", "[object HTMLBodyElement]"],
+  {
+    input: "new Date(" + dateNow + ")",
+    output: "Date " + (new Date(dateNow)).toISOString(),
+    printOutput: (new Date(dateNow)).toString(),
+    inspectable: true,
+  },
 
   // 15
-  [true, "window.location", "[object Location]", TEST_URI, "[object Location]"],
-
-  // 16
-  [true, "[1,2,3,'a','b','c','4','5']", '[object Array]',
-    '1,2,3,a,b,c,4,5',
-    "[object Array]"],
-
-  // 17
-  [true, "({a:'b', c:'d', e:1, f:'2'})", "[object Object]"],
-
-  // 18
-  [false, "'" + longString + "'",
-    '"' + initialString + "\"[\u2026]", initialString],
+  {
+    input: "new Date('test')",
+    output: "Invalid Date",
+    printOutput: "Invalid Date",
+    inspectable: true,
+    variablesViewLabel: "Invalid Date",
+  },
 ];
 
-longString = null;
-initialString = null;
-tempScope = null;
+longString = initialString = null;
 
-let eventHandlers = [];
-let popupShown = [];
-let HUD;
-let testDriver;
+function test() {
+  let hud;
+  let eventHandlers = new Set();
 
-function tabLoad(aEvent) {
-  browser.removeEventListener(aEvent.type, tabLoad, true);
+  addTab(TEST_URI);
+  browser.addEventListener("load", function onLoad() {
+    browser.removeEventListener("load", onLoad, true);
+    Task.spawn(runner);
+  }, true);
 
-  waitForFocus(function () {
-    openConsole(null, function(aHud) {
-      HUD = aHud;
-      testNext();
-    });
-  }, content);
-}
+  function runner()
+  {
+    hud = yield openConsole();
+    for (let [i, entry] of inputTests.entries()) {
+      yield checkInput(i, entry);
+    }
 
-function subtestNext() {
-  testDriver.next();
-}
+    for (let fn of eventHandlers) {
+      hud.jsterm.off("variablesview-open", fn);
+    }
 
-function testNext() {
-  pos++;
-  if (pos == inputValues.length) {
-    testEnd();
-    return;
+    inputTests = null;
+    finishTest();
   }
 
-  testDriver = testGen();
-  testDriver.next();
-}
+  function checkInput(i, entry)
+  {
+    info("checkInput(" + i + "): " + entry.input);
+    hud.jsterm.clearOutput();
 
-function testGen() {
-  let cpos = pos;
+    // Test the console.log() output.
 
-  let showsVariablesView = inputValues[cpos][0];
-  let inputValue = inputValues[cpos][1];
-  let expectedOutput = inputValues[cpos][2];
+    hud.jsterm.execute("console.log(" + entry.input + ")");
 
-  let printOutput = inputValues[cpos].length >= 4 ?
-    inputValues[cpos][3] : expectedOutput;
+    yield waitForMessages({
+      webconsole: hud,
+      messages: [{
+        name: "console.log() output: " + entry.output,
+        text: entry.output,
+        category: CATEGORY_WEBDEV,
+        severity: SEVERITY_LOG,
+      }],
+    });
 
-  let consoleOutput = inputValues[cpos].length >= 5 ?
-    inputValues[cpos][4] : printOutput;
+    hud.jsterm.clearOutput();
 
-  let consoleTest = inputValues[cpos][5] || inputValue;
+    // Test jsterm print() output.
 
-  HUD.jsterm.clearOutput();
+    let printOutput = entry.printOutput || entry.output;
+    hud.jsterm.execute("print(" + entry.input + ")");
 
-  // Test the console.log() output.
+    yield waitForMessages({
+      webconsole: hud,
+      messages: [{
+        name: "print() output: " + printOutput,
+        text: printOutput,
+        category: CATEGORY_OUTPUT,
+      }],
+    });
 
-  let outputItem;
-  function onExecute(msg) {
-    outputItem = msg;
-    subtestNext();
-  }
+    // Test jsterm execution output.
 
-  HUD.jsterm.execute("console.log(" + consoleTest + ")");
+    hud.jsterm.clearOutput();
+    hud.jsterm.execute(entry.input);
 
-  waitForMessages({
-    webconsole: HUD,
-    messages: [{
-      name: "console API output is correct for inputValues[" + cpos + "]",
-      text: consoleOutput,
-      category: CATEGORY_WEBDEV,
-      severity: SEVERITY_LOG,
-    }],
-  }).then(subtestNext);
+    let [result] = yield waitForMessages({
+      webconsole: hud,
+      messages: [{
+        name: "JS eval output: " + entry.output,
+        text: entry.output,
+        category: CATEGORY_OUTPUT,
+      }],
+    });
 
-  yield undefined;
+    let msg = [...result.matched][0];
+    let body = msg.querySelector(".body a") || msg.querySelector(".body");
+    ok(body, "the message body");
 
-  HUD.jsterm.clearOutput();
+    // Test click on output.
+    let deferred = promise.defer();
 
-  // Test jsterm print() output.
+    let variablesViewShown = function(aEvent, aView, aOptions) {
+      let label = entry.variablesViewLabel || entry.output;
+      if (typeof label == "string" && aOptions.label != label) {
+        return;
+      }
+      if (label instanceof RegExp && !label.test(aOptions.label)) {
+        return;
+      }
 
-  HUD.jsterm.setInputValue("print(" + inputValue + ")");
-  HUD.jsterm.execute(null, onExecute);
+      hud.jsterm.off("variablesview-open", variablesViewShown);
 
-  yield undefined;
+      eventHandlers.delete(variablesViewShown);
 
-  ok(outputItem,
-    "found the jsterm print() output line for inputValues[" + cpos + "]");
-  ok(outputItem.textContent.indexOf(printOutput) > -1,
-    "jsterm print() output is correct for inputValues[" + cpos + "]");
+      ok(entry.inspectable, "variables view was shown");
 
-  // Test jsterm execution output.
+      if (entry.inspectable) {
+        deferred.resolve(null);
+      }
+    };
 
-  HUD.jsterm.clearOutput();
-  HUD.jsterm.setInputValue(inputValue);
-  HUD.jsterm.execute(null, onExecute);
+    hud.jsterm.on("variablesview-open", variablesViewShown);
 
-  yield undefined;
+    eventHandlers.add(variablesViewShown);
 
-  ok(outputItem, "found the jsterm output line for inputValues[" + cpos + "]");
-  ok(outputItem.textContent.indexOf(expectedOutput) > -1,
-    "jsterm output is correct for inputValues[" + cpos + "]");
+    body.scrollIntoView();
+    EventUtils.synthesizeMouse(body, 2, 2, {}, hud.iframeWindow);
 
-  let messageBody = outputItem.querySelector(".body a") ||
-                    outputItem.querySelector(".body");
-  ok(messageBody, "we have the message body for inputValues[" + cpos + "]");
-
-  // Test click on output.
-  let eventHandlerID = eventHandlers.length + 1;
-
-  let variablesViewShown = function(aEvent, aView, aOptions) {
-    if (aOptions.label.indexOf(expectedOutput) == -1) {
-      return;
-    }
-
-    HUD.jsterm.off("variablesview-open", variablesViewShown);
-
-    eventHandlers[eventHandlerID] = null;
-
-    ok(showsVariablesView,
-      "the variables view shown for inputValues[" + cpos + "]");
-
-    popupShown[cpos] = true;
-
-    if (showsVariablesView) {
-      executeSoon(subtestNext);
-    }
-  };
-
-  HUD.jsterm.on("variablesview-open", variablesViewShown);
-
-  eventHandlers.push(variablesViewShown);
-
-  EventUtils.synthesizeMouse(messageBody, 2, 2, {}, HUD.iframeWindow);
-
-  if (showsVariablesView) {
-    info("messageBody tagName '" + messageBody.tagName +  "' className '" + messageBody.className + "'");
-    yield undefined; // wait for the panel to open if we need to.
-  }
-
-  testNext();
-
-  yield undefined;
-}
-
-function testEnd() {
-  if (testEnded) {
-    return;
-  }
-
-  testEnded = true;
-
-  for (let i = 0; i < eventHandlers.length; i++) {
-    if (eventHandlers[i]) {
-      HUD.jsterm.off("variablesview-open", eventHandlers[i]);
+    if (entry.inspectable) {
+      info("message body tagName '" + body.tagName +  "' className '" + body.className + "'");
+      yield deferred.promise; // wait for the panel to open if we need to.
     }
   }
-
-  for (let i = 0; i < inputValues.length; i++) {
-    if (inputValues[i][0] && !popupShown[i]) {
-      ok(false, "the variables view failed to show for inputValues[" + i + "]");
-    }
-  }
-
-  HUD = inputValues = testDriver = null;
-  executeSoon(finishTest);
 }
-
-function test() {
-  requestLongerTimeout(2);
-  addTab(TEST_URI);
-  browser.addEventListener("load", tabLoad, true);
-}
-
diff --git a/browser/devtools/webconsole/test/browser_webconsole_output_02.js b/browser/devtools/webconsole/test/browser_webconsole_output_02.js
new file mode 100644
--- /dev/null
+++ b/browser/devtools/webconsole/test/browser_webconsole_output_02.js
@@ -0,0 +1,282 @@
+/*
+ * Any copyright is dedicated to the Public Domain.
+ * http://creativecommons.org/publicdomain/zero/1.0/
+ */
+
+// Test the webconsole output for various types of objects.
+
+const TEST_URI = "http://example.com/browser/browser/devtools/webconsole/test/test-console-output.html";
+
+
+// Each input test object has the following properties:
+//
+// - input: string, JS input value to execute.
+//
+// - output: string|RegExp, expected JS eval result.
+//
+// - inspectable: boolean, tells if the result is expected to be an object you
+// can click on to inspect.
+//
+// - printOutput: string|RegExp, optional, expected output for |print(input)|.
+// If this is not provided, printOutput = output.
+//
+// - variablesViewLabel: string|RegExp, optional, the expected variables view label
+// when the object is inspected. If this is not provided, then |output| is used.
+
+
+let inputTests = [
+  // 0 - native named function
+  {
+    input: "document.getElementById",
+    output: "function getElementById()",
+    printOutput: "function getElementById() {\\n    [native code]\\n}",
+    inspectable: true,
+    variablesViewLabel: "getElementById()",
+  },
+
+  // 1 - anonymous function
+  {
+    input: "(function() { return 42; })",
+    output: "function ()",
+    printOutput: "function () { return 42; }",
+    inspectable: true,
+  },
+
+  // 2 - named function
+  {
+    input: "window.testfn1",
+    output: "function testfn1()",
+    printOutput: "function testfn1() { return 42; }",
+    inspectable: true,
+    variablesViewLabel: "testfn1()",
+  },
+
+  // 3 - anonymous function, but spidermonkey gives us an inferred name.
+  {
+    input: "testobj1.testfn2",
+    output: "function testobj1.testfn2()",
+    printOutput: "function () { return 42; }",
+    inspectable: true,
+    variablesViewLabel: "testobj1.testfn2()",
+  },
+
+  // 4 - named function with custom display name
+  {
+    input: "window.testfn3",
+    output: "function testfn3DisplayName()",
+    printOutput: "function testfn3() { return 42; }",
+    inspectable: true,
+    variablesViewLabel: "testfn3DisplayName()",
+  },
+
+  // 5 - basic array
+  {
+    input: "window.array1",
+    output: '[1, 2, 3, "a", "b", "c", "4", "5"]',
+    printOutput: "1,2,3,a,b,c,4,5",
+    inspectable: true,
+    variablesViewLabel: "Array[8]",
+  },
+
+  // 6 - array with objects
+  {
+    input: "window.array2",
+    output: '["a", HTMLDocument \u2192 test-console-output.html, <body>, ' +
+            "DOMStringMap[0], DOMTokenList[0]]",
+    printOutput: '"a,[object HTMLDocument],[object HTMLBodyElement],' +
+                 '[object DOMStringMap],"',
+    inspectable: true,
+    variablesViewLabel: "Array[5]",
+  },
+
+  // 7 - array with more than 10 elements
+  {
+    input: "window.array3",
+    output: '[1, Window \u2192 test-console-output.html, null, "a", "b", ' +
+            'undefined, false, "", -Infinity, testfn3DisplayName(), 3 more\u2026]',
+    printOutput: '"1,[object Window],,a,b,,false,,-Infinity,' +
+                 'function testfn3() { return 42; },[object Object],foo,bar"',
+    inspectable: true,
+    variablesViewLabel: "Array[13]",
+  },
+
+  // 8 - array with holes and a cyclic reference
+  {
+    input: "window.array4",
+    output: '[,,,,, "test", Array[7]]',
+    printOutput: '",,,,,test,"',
+    inspectable: true,
+    variablesViewLabel: "Array[7]",
+  },
+
+  // 9
+  {
+    input: "window.typedarray1",
+    output: 'Int32Array [1, 287, 8651, 40983, 8754]',
+    printOutput: "[object Int32Array]",
+    inspectable: true,
+    variablesViewLabel: "Int32Array[5]",
+  },
+
+  // 10 - Set with cyclic reference
+  {
+    input: "window.set1",
+    output: 'Set [1, 2, null, Array[13], "a", "b", undefined, <head>, Set[9]]',
+    printOutput: "[object Set]",
+    inspectable: true,
+    variablesViewLabel: "Set[9]",
+  },
+
+  // 11 - Object with cyclic reference and a getter
+  {
+    input: "window.testobj2",
+    output: '{a: "b", c: "d", e: 1, f: "2", foo: Object, bar: Object, ' +
+            "getterTest: Getter}",
+    printOutput: "[object Object]",
+    inspectable: true,
+    variablesViewLabel: "Object",
+  },
+
+  // 12 - Object with more than 10 properties
+  {
+    input: "window.testobj3",
+    output: '{a: "b", c: "d", e: 1, f: "2", g: true, h: null, i: undefined, ' +
+            'j: "", k: StyleSheetList[0], l: NodeList[5], 2 more\u2026}',
+    printOutput: "[object Object]",
+    inspectable: true,
+    variablesViewLabel: "Object",
+  },
+
+  // 13 - Object with a non-enumerable property that we do not show
+  {
+    input: "window.testobj4",
+    output: '{a: "b", c: "d", 1 more\u2026}',
+    printOutput: "[object Object]",
+    inspectable: true,
+    variablesViewLabel: "Object",
+  },
+
+  // 14 - Map with cyclic references
+  {
+    input: "window.map1",
+    output: 'Map {a: "b", HTMLCollection[2]: Object, Map[3]: Set[9]}',
+    printOutput: "[object Map]",
+    inspectable: true,
+    variablesViewLabel: "Map[3]",
+  },
+];
+
+function test() {
+  let hud;
+  let eventHandlers = new Set();
+
+  addTab(TEST_URI);
+  browser.addEventListener("load", function onLoad() {
+    browser.removeEventListener("load", onLoad, true);
+    Task.spawn(runner);
+  }, true);
+
+  function runner()
+  {
+    hud = yield openConsole();
+    for (let [i, entry] of inputTests.entries()) {
+      yield checkInput(i, entry);
+    }
+
+    for (let fn of eventHandlers) {
+      hud.jsterm.off("variablesview-open", fn);
+    }
+
+    inputTests = null;
+    finishTest();
+  }
+
+  function checkInput(i, entry)
+  {
+    info("checkInput(" + i + "): " + entry.input);
+    hud.jsterm.clearOutput();
+
+    // Test the console.log() output.
+
+    hud.jsterm.execute("console.log(" + entry.input + ")");
+
+    yield waitForMessages({
+      webconsole: hud,
+      messages: [{
+        name: "console.log() output: " + entry.output,
+        text: entry.output,
+        category: CATEGORY_WEBDEV,
+        severity: SEVERITY_LOG,
+      }],
+    });
+
+    hud.jsterm.clearOutput();
+
+    // Test jsterm print() output.
+
+    let printOutput = entry.printOutput || entry.output;
+    hud.jsterm.execute("print(" + entry.input + ")");
+
+    yield waitForMessages({
+      webconsole: hud,
+      messages: [{
+        name: "print() output: " + printOutput,
+        text: printOutput,
+        category: CATEGORY_OUTPUT,
+      }],
+    });
+
+    // Test jsterm execution output.
+
+    hud.jsterm.clearOutput();
+    hud.jsterm.execute(entry.input);
+
+    let [result] = yield waitForMessages({
+      webconsole: hud,
+      messages: [{
+        name: "JS eval output: " + entry.output,
+        text: entry.output,
+        category: CATEGORY_OUTPUT,
+      }],
+    });
+
+    let msg = [...result.matched][0];
+    let body = msg.querySelector(".body a") || msg.querySelector(".body");
+    ok(body, "the message body");
+
+    // Test click on output.
+    let deferred = promise.defer();
+
+    let variablesViewShown = function(aEvent, aView, aOptions) {
+      let label = entry.variablesViewLabel || entry.output;
+      if (typeof label == "string" && aOptions.label != label) {
+        return;
+      }
+      if (label instanceof RegExp && !label.test(aOptions.label)) {
+        return;
+      }
+
+      hud.jsterm.off("variablesview-open", variablesViewShown);
+
+      eventHandlers.delete(variablesViewShown);
+
+      ok(entry.inspectable, "variables view was shown");
+
+      if (entry.inspectable) {
+        deferred.resolve(null);
+      }
+    };
+
+    hud.jsterm.on("variablesview-open", variablesViewShown);
+
+    eventHandlers.add(variablesViewShown);
+
+    body.scrollIntoView();
+    EventUtils.synthesizeMouse(body, 2, 2, {}, hud.iframeWindow);
+
+    if (entry.inspectable) {
+      info("message body tagName '" + body.tagName +  "' className '" + body.className + "'");
+      yield deferred.promise; // wait for the panel to open if we need to.
+    }
+  }
+}
diff --git a/browser/devtools/webconsole/test/browser_webconsole_output_03.js b/browser/devtools/webconsole/test/browser_webconsole_output_03.js
new file mode 100644
--- /dev/null
+++ b/browser/devtools/webconsole/test/browser_webconsole_output_03.js
@@ -0,0 +1,284 @@
+/*
+ * Any copyright is dedicated to the Public Domain.
+ * http://creativecommons.org/publicdomain/zero/1.0/
+ */
+
+// Test the webconsole output for various types of objects.
+
+const TEST_URI = "http://example.com/browser/browser/devtools/webconsole/test/test-console-output.html";
+
+
+// Each input test object has the following properties:
+//
+// - input: string, JS input value to execute.
+//
+// - output: string|RegExp, expected JS eval result.
+//
+// - inspectable: boolean, tells if the result is expected to be an object you
+// can click on to inspect.
+//
+// - printOutput: string|RegExp, optional, expected output for |print(input)|.
+// If this is not provided, printOutput = output.
+//
+// - variablesViewLabel: string|RegExp, optional, the expected variables view label
+// when the object is inspected. If this is not provided, then |output| is used.
+
+
+let inputTests = [
+  // 0
+  {
+    input: "document",
+    output: "HTMLDocument \u2192 " + TEST_URI,
+    printOutput: "[object HTMLDocument]",
+    inspectable: true,
+    variablesViewLabel: "HTMLDocument \u2192 test-console-output.html",
+  },
+
+  // 1
+  {
+    input: "window",
+    output: "Window \u2192 " + TEST_URI,
+    printOutput: "[object Window]",
+    inspectable: true,
+    variablesViewLabel: "Window \u2192 test-console-output.html",
+  },
+
+  // 2
+  {
+    input: "document.body",
+    output: "<body>",
+    printOutput: "[object HTMLBodyElement]",
+    inspectable: true,
+  },
+
+  // 3
+  {
+    input: "document.body.dataset",
+    output: "DOMStringMap {}",
+    printOutput: "[object DOMStringMap]",
+    inspectable: true,
+    variablesViewLabel: "DOMStringMap[0]",
+  },
+
+  // 4
+  {
+    input: "document.body.classList",
+    output: "DOMTokenList []",
+    printOutput: '""',
+    inspectable: true,
+    variablesViewLabel: "DOMTokenList[0]",
+  },
+
+  // 5
+  {
+    input: "window.location.href",
+    output: '"' + TEST_URI + '"',
+  },
+
+  // 6
+  {
+    input: "window.location",
+    output: "Location \u2192 " + TEST_URI,
+    printOutput: TEST_URI,
+    inspectable: true,
+    variablesViewLabel: "Location \u2192 test-console-output.html",
+  },
+
+  // 7
+  {
+    input: "document.body.attributes",
+    output: "MozNamedAttrMap []",
+    printOutput: "[object MozNamedAttrMap]",
+    inspectable: true,
+    variablesViewLabel: "MozNamedAttrMap[0]",
+  },
+
+  // 8
+  {
+    input: "document.styleSheets",
+    output: "StyleSheetList []",
+    printOutput: "[object StyleSheetList]",
+    inspectable: true,
+    variablesViewLabel: "StyleSheetList[0]",
+  },
+
+  // 9
+  {
+    input: "testBodyClassName()",
+    output: '<body class="test1 tezt2">',
+    printOutput: "[object HTMLBodyElement]",
+    inspectable: true,
+    variablesViewLabel: "<body>",
+  },
+
+  // 10
+  {
+    input: "testBodyID()",
+    output: '<body class="test1 tezt2" id="foobarid">',
+    printOutput: "[object HTMLBodyElement]",
+    inspectable: true,
+    variablesViewLabel: "<body#foobarid>",
+  },
+
+  // 11
+  {
+    input: "document.body.classList",
+    output: 'DOMTokenList ["test1", "tezt2"]',
+    printOutput: '"test1 tezt2"',
+    inspectable: true,
+    variablesViewLabel: "DOMTokenList[2]",
+  },
+
+  // 12
+  {
+    input: "testBodyDataset()",
+    output: '<body class="test1 tezt2" id="foobarid"' +
+            ' data-preview="zuzu&quot;&lt;a&gt;foo">',
+    printOutput: "[object HTMLBodyElement]",
+    inspectable: true,
+    variablesViewLabel: "<body#foobarid>",
+  },
+
+  // 13
+  {
+    input: "document.body.dataset",
+    output: 'DOMStringMap {preview: "zuzu\\"<a>foo"}',
+    printOutput: "[object DOMStringMap]",
+    inspectable: true,
+    variablesViewLabel: "DOMStringMap[1]",
+  },
+
+  // 14
+  {
+    input: "document.body.attributes",
+    output: 'MozNamedAttrMap [class="test1 tezt2", id="foobarid", ' +
+            'data-preview="zuzu&quot;&lt;a&gt;foo"]',
+    printOutput: "[object MozNamedAttrMap]",
+    inspectable: true,
+    variablesViewLabel: "MozNamedAttrMap[3]",
+  },
+
+  // 15
+  {
+    input: "document.body.attributes[0]",
+    output: 'class="test1 tezt2"',
+    printOutput: "[object Attr]",
+    inspectable: true,
+    variablesViewLabel: 'class="test1 tezt2"',
+  },
+];
+
+function test() {
+  let hud;
+  let eventHandlers = new Set();
+
+  addTab(TEST_URI);
+  browser.addEventListener("load", function onLoad() {
+    browser.removeEventListener("load", onLoad, true);
+    Task.spawn(runner);
+  }, true);
+
+  function runner()
+  {
+    hud = yield openConsole();
+    for (let [i, entry] of inputTests.entries()) {
+      yield checkInput(i, entry);
+    }
+
+    for (let fn of eventHandlers) {
+      hud.jsterm.off("variablesview-open", fn);
+    }
+
+    inputTests = null;
+    finishTest();
+  }
+
+  function checkInput(i, entry)
+  {
+    info("checkInput(" + i + "): " + entry.input);
+    hud.jsterm.clearOutput();
+
+    // Test the console.log() output.
+
+    hud.jsterm.execute("console.log(" + entry.input + ")");
+
+    yield waitForMessages({
+      webconsole: hud,
+      messages: [{
+        name: "console.log() output: " + entry.output,
+        text: entry.output,
+        category: CATEGORY_WEBDEV,
+        severity: SEVERITY_LOG,
+      }],
+    });
+
+    hud.jsterm.clearOutput();
+
+    // Test jsterm print() output.
+
+    let printOutput = entry.printOutput || entry.output;
+    hud.jsterm.execute("print(" + entry.input + ")");
+
+    yield waitForMessages({
+      webconsole: hud,
+      messages: [{
+        name: "print() output: " + printOutput,
+        text: printOutput,
+        category: CATEGORY_OUTPUT,
+      }],
+    });
+
+    // Test jsterm execution output.
+
+    hud.jsterm.clearOutput();
+    hud.jsterm.execute(entry.input);
+
+    let [result] = yield waitForMessages({
+      webconsole: hud,
+      messages: [{
+        name: "JS eval output: " + entry.output,
+        text: entry.output,
+        category: CATEGORY_OUTPUT,
+      }],
+    });
+
+    let msg = [...result.matched][0];
+    let body = msg.querySelector(".body a") || msg.querySelector(".body");
+    ok(body, "the message body");
+
+    // Test click on output.
+    let deferred = promise.defer();
+
+    let variablesViewShown = function(aEvent, aView, aOptions) {
+      let label = entry.variablesViewLabel || entry.output;
+      if (typeof label == "string" && aOptions.label != label) {
+        return;
+      }
+      if (label instanceof RegExp && !label.test(aOptions.label)) {
+        return;
+      }
+
+      hud.jsterm.off("variablesview-open", variablesViewShown);
+
+      eventHandlers.delete(variablesViewShown);
+
+      ok(entry.inspectable, "variables view was shown");
+
+      if (entry.inspectable) {
+        deferred.resolve(null);
+      }
+    };
+
+    hud.jsterm.on("variablesview-open", variablesViewShown);
+
+    eventHandlers.add(variablesViewShown);
+
+    body.scrollIntoView();
+    EventUtils.synthesizeMouse(body, 2, 2, {}, hud.iframeWindow);
+
+    if (entry.inspectable) {
+      info("message body tagName '" + body.tagName +  "' className '" + body.className + "'");
+      yield deferred.promise; // wait for the panel to open if we need to.
+    }
+  }
+}
diff --git a/browser/devtools/webconsole/test/browser_webconsole_output_04.js b/browser/devtools/webconsole/test/browser_webconsole_output_04.js
new file mode 100644
--- /dev/null
+++ b/browser/devtools/webconsole/test/browser_webconsole_output_04.js
@@ -0,0 +1,240 @@
+/*
+ * Any copyright is dedicated to the Public Domain.
+ * http://creativecommons.org/publicdomain/zero/1.0/
+ */
+
+// Test the webconsole output for various types of objects.
+
+const TEST_URI = "http://example.com/browser/browser/devtools/webconsole/test/test-console-output.html";
+
+
+// Each input test object has the following properties:
+//
+// - input: string, JS input value to execute.
+//
+// - output: string|RegExp, expected JS eval result.
+//
+// - inspectable: boolean, tells if the result is expected to be an object you
+// can click on to inspect.
+//
+// - printOutput: string|RegExp, optional, expected output for |print(input)|.
+// If this is not provided, printOutput = output.
+//
+// - variablesViewLabel: string|RegExp, optional, the expected variables view label
+// when the object is inspected. If this is not provided, then |output| is used.
+
+let inputTests = [
+  // 0
+  {
+    input: "testTextNode()",
+    output: '#text "hello world!"',
+    printOutput: "[object Text]",
+    inspectable: true,
+  },
+
+  // 1
+  {
+    input: "testCommentNode()",
+    output: "<!--\n  - Any copyright ",
+    printOutput: "[object Comment]",
+    inspectable: true,
+    variablesViewLabel: /^<!--[\s\r\n]+- Any copyright /,
+  },
+
+  // 2
+  {
+    input: "testDocumentFragment()",
+    output: 'DocumentFragment [<div id="foo1" class="bar">, <div id="foo3">]',
+    printOutput: "[object DocumentFragment]",
+    inspectable: true,
+    variablesViewLabel: "DocumentFragment[2]",
+  },
+
+  // 3
+  {
+    input: "testError()",
+    output: "TypeError: window.foobar is not a function\n" +
+            "Stack trace:\n" +
+            "testError@" + TEST_URI + ":113",
+    printOutput: '"TypeError: window.foobar is not a function"',
+    inspectable: true,
+    variablesViewLabel: "TypeError",
+  },
+
+  // 4
+  {
+    input: "testDOMException()",
+    output: 'DOMException [SyntaxError: "An invalid or illegal string was specified"',
+    printOutput: '[Exception... \\"An invalid or illegal string was specified\\"',
+    inspectable: true,
+    variablesViewLabel: "SyntaxError",
+  },
+
+  // 5
+  {
+    input: "testCSSStyleDeclaration()",
+    output: 'CSS2Properties {color: "green", font-size: "2em"}',
+    printOutput: "[object CSS2Properties]",
+    inspectable: true,
+    variablesViewLabel: "CSS2Properties[2]",
+  },
+
+  // 6
+  {
+    input: "testStyleSheetList()",
+    output: "StyleSheetList [CSSStyleSheet]",
+    printOutput: "[object StyleSheetList]",
+    inspectable: true,
+    variablesViewLabel: "StyleSheetList[1]",
+  },
+
+  // 7
+  {
+    input: "document.styleSheets[0]",
+    output: "CSSStyleSheet",
+    printOutput: "[object CSSStyleSheet]",
+    inspectable: true,
+  },
+
+  // 8
+  {
+    input: "document.styleSheets[0].cssRules",
+    output: "CSSRuleList [CSSStyleRule, CSSMediaRule]",
+    printOutput: "[object CSSRuleList]",
+    inspectable: true,
+    variablesViewLabel: "CSSRuleList[2]",
+  },
+
+  // 9
+  {
+    input: "document.styleSheets[0].cssRules[0]",
+    output: 'CSSStyleRule "p, div"',
+    printOutput: "[object CSSStyleRule]",
+    inspectable: true,
+    variablesViewLabel: "CSSStyleRule",
+  },
+
+  // 10
+  {
+    input: "document.styleSheets[0].cssRules[1]",
+    output: 'CSSMediaRule "print"',
+    printOutput: "[object CSSMediaRule]",
+    inspectable: true,
+    variablesViewLabel: "CSSMediaRule",
+  },
+];
+
+function test() {
+  let hud;
+  let eventHandlers = new Set();
+
+  addTab(TEST_URI);
+  browser.addEventListener("load", function onLoad() {
+    browser.removeEventListener("load", onLoad, true);
+    Task.spawn(runner);
+  }, true);
+
+  function runner()
+  {
+    hud = yield openConsole();
+    for (let [i, entry] of inputTests.entries()) {
+      yield checkInput(i, entry);
+    }
+
+    for (let fn of eventHandlers) {
+      hud.jsterm.off("variablesview-open", fn);
+    }
+
+    inputTests = null;
+    finishTest();
+  }
+
+  function checkInput(i, entry)
+  {
+    info("checkInput(" + i + "): " + entry.input);
+    hud.jsterm.clearOutput();
+
+    // Test the console.log() output.
+
+    hud.jsterm.execute("console.log(" + entry.input + ")");
+
+    yield waitForMessages({
+      webconsole: hud,
+      messages: [{
+        name: "console.log() output: " + entry.output,
+        text: entry.output,
+        category: CATEGORY_WEBDEV,
+        severity: SEVERITY_LOG,
+      }],
+    });
+
+    hud.jsterm.clearOutput();
+
+    // Test jsterm print() output.
+
+    let printOutput = entry.printOutput || entry.output;
+    hud.jsterm.execute("print(" + entry.input + ")");
+
+    yield waitForMessages({
+      webconsole: hud,
+      messages: [{
+        name: "print() output: " + printOutput,
+        text: printOutput,
+        category: CATEGORY_OUTPUT,
+      }],
+    });
+
+    // Test jsterm execution output.
+
+    hud.jsterm.clearOutput();
+    hud.jsterm.execute(entry.input);
+
+    let [result] = yield waitForMessages({
+      webconsole: hud,
+      messages: [{
+        name: "JS eval output: " + entry.output,
+        text: entry.output,
+        category: CATEGORY_OUTPUT,
+      }],
+    });
+
+    let msg = [...result.matched][0];
+    let body = msg.querySelector(".body a") || msg.querySelector(".body");
+    ok(body, "the message body");
+
+    // Test click on output.
+    let deferred = promise.defer();
+
+    let variablesViewShown = function(aEvent, aView, aOptions) {
+      let label = entry.variablesViewLabel || entry.output;
+      if (typeof label == "string" && aOptions.label != label) {
+        return;
+      }
+      if (label instanceof RegExp && !label.test(aOptions.label)) {
+        return;
+      }
+
+      hud.jsterm.off("variablesview-open", variablesViewShown);
+
+      eventHandlers.delete(variablesViewShown);
+
+      ok(entry.inspectable, "variables view was shown");
+
+      if (entry.inspectable) {
+        deferred.resolve(null);
+      }
+    };
+
+    hud.jsterm.on("variablesview-open", variablesViewShown);
+
+    eventHandlers.add(variablesViewShown);
+
+    body.scrollIntoView();
+    EventUtils.synthesizeMouse(body, 2, 2, {}, hud.iframeWindow);
+
+    if (entry.inspectable) {
+      info("message body tagName '" + body.tagName +  "' className '" + body.className + "'");
+      yield deferred.promise; // wait for the panel to open if we need to.
+    }
+  }
+}
diff --git a/browser/devtools/webconsole/test/browser_webconsole_output_events.js b/browser/devtools/webconsole/test/browser_webconsole_output_events.js
new file mode 100644
--- /dev/null
+++ b/browser/devtools/webconsole/test/browser_webconsole_output_events.js
@@ -0,0 +1,62 @@
+/*
+ * Any copyright is dedicated to the Public Domain.
+ * http://creativecommons.org/publicdomain/zero/1.0/
+ */
+
+// Test the webconsole output for DOM events.
+
+const TEST_URI = "http://example.com/browser/browser/devtools/webconsole/test/test-console-output.html";
+
+function test() {
+  let hud;
+
+  addTab(TEST_URI);
+  browser.addEventListener("load", function onLoad() {
+    browser.removeEventListener("load", onLoad, true);
+    Task.spawn(runner);
+  }, true);
+
+  function runner()
+  {
+    hud = yield openConsole();
+
+    hud.jsterm.clearOutput();
+    hud.jsterm.execute("testDOMEvents()");
+
+    yield waitForMessages({
+      webconsole: hud,
+      messages: [{
+        name: "testDOMEvents() output",
+        text: "undefined",
+        category: CATEGORY_OUTPUT,
+      }],
+    });
+
+    EventUtils.synthesizeMouse(content.document.body, 2, 2, {type: "mousemove"}, content);
+
+    yield waitForMessages({
+      webconsole: hud,
+      messages: [{
+        name: "console.log() output for mousemove",
+        text: /"eventLogger" mousemove {target: .+, buttons: 1, clientX: \d+, clientY: \d+, layerX: \d+, layerY: \d+}/,
+        category: CATEGORY_WEBDEV,
+        severity: SEVERITY_LOG,
+      }],
+    });
+
+    content.focus();
+    EventUtils.synthesizeKey("a", {shiftKey: true}, content);
+
+    yield waitForMessages({
+      webconsole: hud,
+      messages: [{
+        name: "console.log() output for keypress",
+        text: /"eventLogger" keypress Shift {target: .+, key: .+, charCode: \d+, keyCode: \d+}/,
+        category: CATEGORY_WEBDEV,
+        severity: SEVERITY_LOG,
+      }],
+    });
+
+    finishTest();
+  }
+}
diff --git a/browser/devtools/webconsole/test/head.js b/browser/devtools/webconsole/test/head.js
--- a/browser/devtools/webconsole/test/head.js
+++ b/browser/devtools/webconsole/test/head.js
@@ -1,19 +1,20 @@
 /* vim:set ts=2 sw=2 sts=2 et: */
 /* This Source Code Form is subject to the terms of the Mozilla Public
  * License, v. 2.0. If a copy of the MPL was not distributed with this
  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */
 
-let WebConsoleUtils, gDevTools, TargetFactory, console, promise, require;
+let WebConsoleUtils, gDevTools, TargetFactory, console, promise, require, Task;
 
 (() => {
   gDevTools = Cu.import("resource:///modules/devtools/gDevTools.jsm", {}).gDevTools;
   console = Cu.import("resource://gre/modules/devtools/Console.jsm", {}).console;
   promise = Cu.import("resource://gre/modules/commonjs/sdk/core/promise.js", {}).Promise;
+  Task = Cu.import("resource://gre/modules/Task.jsm", {}).Task;
 
   let tools = Cu.import("resource://gre/modules/devtools/Loader.jsm", {}).devtools;
   let utils = tools.require("devtools/toolkit/webconsole/utils");
   TargetFactory = tools.TargetFactory;
   WebConsoleUtils = utils.Utils;
   require = tools.require;
 })();
 // promise._reportErrors = true; // please never leave me.
@@ -147,25 +148,30 @@ function findLogEntry(aString)
  * Open the Web Console for the given tab.
  *
  * @param nsIDOMElement [aTab]
  *        Optional tab element for which you want open the Web Console. The
  *        default tab is taken from the global variable |tab|.
  * @param function [aCallback]
  *        Optional function to invoke after the Web Console completes
  *        initialization (web-console-created).
+ * @return object
+ *         A promise that is resolved once the web console is open.
  */
 function openConsole(aTab, aCallback = function() { })
 {
+  let deferred = promise.defer();
   let target = TargetFactory.forTab(aTab || tab);
   gDevTools.showToolbox(target, "webconsole").then(function(toolbox) {
     let hud = toolbox.getCurrentPanel().hud;
     hud.jsterm._lazyVariablesView = false;
     aCallback(hud);
+    deferred.resolve(hud);
   });
+  return deferred.promise;
 }
 
 /**
  * Close the Web Console for the given tab.
  *
  * @param nsIDOMElement [aTab]
  *        Optional tab element for which you want close the Web Console. The
  *        default tab is taken from the global variable |tab|.
diff --git a/browser/devtools/webconsole/test/test-console-output.html b/browser/devtools/webconsole/test/test-console-output.html
new file mode 100644
--- /dev/null
+++ b/browser/devtools/webconsole/test/test-console-output.html
@@ -0,0 +1,157 @@
+<!DOCTYPE HTML>
+<html dir="ltr" lang="en-US">
+<head>
+  <meta charset="utf-8">
+  <title>Test the web console output</title>
+  <!--
+  - Any copyright is dedicated to the Public Domain.
+  - http://creativecommons.org/publicdomain/zero/1.0/
+  -->
+</head>
+<body>
+  <p>hello world!</p>
+  <script type="text/javascript">
+
+// For test browser_webconsole_output_02.js:
+
+function testfn1() { return 42; }
+
+var testobj1 = {
+  testfn2: function() { return 42; },
+};
+
+function testfn3() { return 42; }
+testfn3.displayName = "testfn3DisplayName";
+
+var array1 = [1, 2, 3, "a", "b", "c", "4", "5"];
+
+var array2 = ["a", document, document.body, document.body.dataset,
+              document.body.classList];
+
+var array3 = [1, window, null, "a", "b", undefined, false, "", -Infinity, testfn3, testobj1, "foo", "bar"];
+
+var array4 = new Array(5);
+array4.push("test");
+array4.push(array4);
+
+var typedarray1 = new Int32Array([1, 287, 8651, 40983, 8754]);
+
+var set1 = new Set([1, 2, null, array3, "a", "b", undefined, document.head]);
+set1.add(set1);
+
+var testobj2 = {a: "b", c: "d", e: 1, f: "2"};
+testobj2.foo = testobj1;
+testobj2.bar = testobj2;
+Object.defineProperty(testobj2, "getterTest", {
+  enumerable: true,
+  get: function() {
+    return 42;
+  },
+});
+
+var testobj3 = {a: "b", c: "d", e: 1, f: "2", g: true, h: null, i: undefined,
+                j: "", k: document.styleSheets, l: document.body.childNodes,
+                o: new Array(125), m: document.head};
+
+var testobj4 = {a: "b", c: "d"};
+Object.defineProperty(testobj4, "nonEnumerable", { value: "hello world" });
+
+var map1 = new Map([["a", "b"], [document.body.children, testobj2]]);
+map1.set(map1, set1);
+
+
+// For test browser_webconsole_output_03.js:
+
+function testBodyClassName() {
+  document.body.className = "test1 tezt2";
+  return document.body;
+}
+
+function testBodyID() {
+  document.body.id = 'foobarid';
+  return document.body;
+}
+
+function testBodyDataset() {
+  document.body.dataset.preview = 'zuzu"<a>foo';
+  return document.body;
+}
+
+
+// For test browser_webconsole_output_04.js:
+
+function testTextNode() {
+  return document.querySelector("p").childNodes[0];
+}
+
+function testCommentNode() {
+  return document.head.childNodes[5];
+}
+
+function testDocumentFragment() {
+  var frag = document.createDocumentFragment();
+
+  var div = document.createElement("div");
+  div.id = "foo1";
+  div.className = "bar";
+  frag.appendChild(div);
+
+  var span = document.createElement("span");
+  span.id = "foo2";
+  span.textContent = "hello world";
+  div.appendChild(span);
+
+  var div2 = document.createElement("div");
+  div2.id = "foo3";
+  frag.appendChild(div2);
+
+  return frag;
+}
+
+function testError() {
+  try {
+    window.foobar("a");
+  } catch (ex) {
+    return ex;
+  }
+  return null;
+}
+
+function testDOMException() {
+  try {
+    var foo = document.querySelector("foo;()bar!");
+  } catch (ex) {
+    return ex;
+  }
+  return null;
+}
+
+function testCSSStyleDeclaration() {
+  document.body.style = 'color: green; font-size: 2em';
+  return document.body.style;
+}
+
+function testStyleSheetList() {
+  var style = document.querySelector("style");
+  if (!style) {
+    style = document.createElement("style");
+    style.textContent = "p, div { color: blue; font-weight: bold }\n" +
+                        "@media print { p { background-color: yellow } }";
+    document.head.appendChild(style);
+  }
+  return document.styleSheets;
+}
+
+// For test browser_webconsole_output_events.js:
+
+function testDOMEvents() {
+  function eventLogger(ev) {
+    console.log("eventLogger", ev);
+  }
+  document.addEventListener("mousemove", eventLogger);
+  document.addEventListener("keypress", eventLogger);
+}
+
+  </script>
+</body>
+</html>
diff --git a/browser/devtools/webconsole/webconsole.js b/browser/devtools/webconsole/webconsole.js
--- a/browser/devtools/webconsole/webconsole.js
+++ b/browser/devtools/webconsole/webconsole.js
@@ -4257,16 +4257,17 @@ JSTerm.prototype = {
     }
     else if (completionType == this.COMPLETE_BACKWARD) {
       popup.selectPreviousItem();
     }
     else if (completionType == this.COMPLETE_FORWARD) {
       popup.selectNextItem();
     }
 
+    this.emit("autocomplete-updated");
     aCallback && aCallback(this);
   },
 
   onAutocompleteSelect: function JSTF_onAutocompleteSelect()
   {
     // Render the suggestion only if the cursor is at the end of the input.
     if (this.inputNode.selectionStart != this.inputNode.value.length) {
       return;
