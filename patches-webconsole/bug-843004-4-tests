# HG changeset patch
# Parent 22e5cf0c8e8faf37e20d9ce59fbb5f84d4b8fd96
# User Mihai Sucan <mihai.sucan@gmail.com>
# Date 1387225519 -7200

Bug 843004 - Part 4: test fixes; r=benvie; try: -b do -p all -u all -t none

diff --git a/browser/devtools/debugger/test/browser_dbg_closure-inspection.js b/browser/devtools/debugger/test/browser_dbg_closure-inspection.js
--- a/browser/devtools/debugger/test/browser_dbg_closure-inspection.js
+++ b/browser/devtools/debugger/test/browser_dbg_closure-inspection.js
@@ -72,23 +72,23 @@ function test() {
           return;
         }
         window.clearInterval(intervalID);
 
         is(personNode.get("getName").target.querySelector(".name")
            .getAttribute("value"), "getName",
           "Should have the right property name for 'getName' in person.");
         is(personNode.get("getName").target.querySelector(".value")
-           .getAttribute("value"), "Function",
+           .getAttribute("value"), "_pfactory/<.getName()",
           "'getName' in person should have the right value.");
         is(personNode.get("getFoo").target.querySelector(".name")
            .getAttribute("value"), "getFoo",
           "Should have the right property name for 'getFoo' in person.");
         is(personNode.get("getFoo").target.querySelector(".value")
-           .getAttribute("value"), "Function",
+           .getAttribute("value"), "_pfactory/<.getFoo()",
           "'getFoo' in person should have the right value.");
 
         // Expand the function nodes. This causes their properties to be
         // retrieved and displayed.
         let getFooNode = personNode.get("getFoo");
         let getNameNode = personNode.get("getName");
         getFooNode.expand();
         getNameNode.expand();
diff --git a/browser/devtools/debugger/test/browser_dbg_pause-exceptions-01.js b/browser/devtools/debugger/test/browser_dbg_pause-exceptions-01.js
--- a/browser/devtools/debugger/test/browser_dbg_pause-exceptions-01.js
+++ b/browser/devtools/debugger/test/browser_dbg_pause-exceptions-01.js
@@ -53,17 +53,17 @@ function testPauseOnExceptionsDisabled()
 
     is(gFrames.itemCount, 1,
       "Should have one frame.");
     is(gVariables._store.length, 3,
       "Should have three scopes.");
 
     is(innerNodes[0].querySelector(".name").getAttribute("value"), "this",
       "Should have the right property name for 'this'.");
-    is(innerNodes[0].querySelector(".value").getAttribute("value"), "HTMLButtonElement",
+    is(innerNodes[0].querySelector(".value").getAttribute("value"), "<button>",
       "Should have the right property value for 'this'.");
 
     let finished = waitForDebuggerEvents(gPanel, gDebugger.EVENTS.AFTER_FRAMES_CLEARED).then(() => {
       isnot(gDebugger.gThreadClient.state, "paused",
         "Should not be paused after resuming.");
       ok(isCaretPos(gPanel, 26),
         "Should be idle on the debugger statement.");
 
@@ -119,17 +119,17 @@ function testPauseOnExceptionsEnabled() 
 
       is(gFrames.itemCount, 1,
         "Should have one frame.");
       is(gVariables._store.length, 3,
         "Should have three scopes.");
 
       is(innerNodes[0].querySelector(".name").getAttribute("value"), "this",
         "Should have the right property name for 'this'.");
-      is(innerNodes[0].querySelector(".value").getAttribute("value"), "HTMLButtonElement",
+      is(innerNodes[0].querySelector(".value").getAttribute("value"), "<button>",
         "Should have the right property value for 'this'.");
 
       let finished = waitForDebuggerEvents(gPanel, gDebugger.EVENTS.AFTER_FRAMES_CLEARED).then(() => {
         isnot(gDebugger.gThreadClient.state, "paused",
           "Should not be paused after resuming.");
         ok(isCaretPos(gPanel, 26),
           "Should be idle on the debugger statement.");
 
diff --git a/browser/devtools/debugger/test/browser_dbg_pause-exceptions-02.js b/browser/devtools/debugger/test/browser_dbg_pause-exceptions-02.js
--- a/browser/devtools/debugger/test/browser_dbg_pause-exceptions-02.js
+++ b/browser/devtools/debugger/test/browser_dbg_pause-exceptions-02.js
@@ -74,17 +74,17 @@ function testPauseOnExceptionsAfterReloa
 
       is(gFrames.itemCount, 1,
         "Should have one frame.");
       is(gVariables._store.length, 3,
         "Should have three scopes.");
 
       is(innerNodes[0].querySelector(".name").getAttribute("value"), "this",
         "Should have the right property name for 'this'.");
-      is(innerNodes[0].querySelector(".value").getAttribute("value"), "HTMLButtonElement",
+      is(innerNodes[0].querySelector(".value").getAttribute("value"), "<button>",
         "Should have the right property value for 'this'.");
 
       let finished = waitForDebuggerEvents(gPanel, gDebugger.EVENTS.AFTER_FRAMES_CLEARED).then(() => {
         isnot(gDebugger.gThreadClient.state, "paused",
           "Should not be paused after resuming.");
         ok(isCaretPos(gPanel, 26),
           "Should be idle on the debugger statement.");
 
diff --git a/browser/devtools/debugger/test/browser_dbg_variables-view-edit-value.js b/browser/devtools/debugger/test/browser_dbg_variables-view-edit-value.js
--- a/browser/devtools/debugger/test/browser_dbg_variables-view-edit-value.js
+++ b/browser/devtools/debugger/test/browser_dbg_variables-view-edit-value.js
@@ -17,26 +17,26 @@ function test() {
     gPanel = aPanel;
     gDebugger = gPanel.panelWin;
     gVars = gDebugger.DebuggerView.Variables;
 
     waitForSourceAndCaretAndScopes(gPanel, ".html", 24)
       .then(() => initialChecks())
       .then(() => testModification("a", "1"))
       .then(() => testModification("{ a: 1 }", "Object"))
-      .then(() => testModification("[a]", "Array"))
+      .then(() => testModification("[a]", "Array[1]"))
       .then(() => testModification("b", "Object"))
       .then(() => testModification("b.a", "1"))
       .then(() => testModification("c.a", "1"))
       .then(() => testModification("Infinity", "Infinity"))
       .then(() => testModification("NaN", "NaN"))
-      .then(() => testModification("new Function", "Function"))
+      .then(() => testModification("new Function", "anonymous()"))
       .then(() => testModification("+0", "0"))
       .then(() => testModification("-0", "-0"))
-      .then(() => testModification("Object.keys({})", "Array"))
+      .then(() => testModification("Object.keys({})", "Array[0]"))
       .then(() => testModification("document.title", '"Debugger test page"'))
       .then(() => resumeDebuggerThenCloseAndFinish(gPanel))
       .then(null, aError => {
         ok(false, "Got an error: " + aError.message + "\n" + aError.stack);
       });
 
     EventUtils.sendMouseEvent({ type: "click" },
       gDebuggee.document.querySelector("button"),
diff --git a/browser/devtools/debugger/test/browser_dbg_variables-view-frame-parameters-01.js b/browser/devtools/debugger/test/browser_dbg_variables-view-frame-parameters-01.js
--- a/browser/devtools/debugger/test/browser_dbg_variables-view-frame-parameters-01.js
+++ b/browser/devtools/debugger/test/browser_dbg_variables-view-frame-parameters-01.js
@@ -84,24 +84,26 @@ function testExpandVariables() {
   is(argsVar.expanded, false,
     "The argsVar should not be expanded at this point.");
   is(cVar.expanded, false,
     "The cVar should not be expanded at this point.");
 
   waitForDebuggerEvents(gPanel, gDebugger.EVENTS.FETCHED_PROPERTIES, 3).then(() => {
     is(thisVar.get("window").target.querySelector(".name").getAttribute("value"), "window",
       "Should have the right property name for 'window'.");
-    is(thisVar.get("window").target.querySelector(".value").getAttribute("value"), "Window",
+    is(thisVar.get("window").target.querySelector(".value").getAttribute("value"),
+      "Window \u2192 doc_frame-parameters.html",
       "Should have the right property value for 'window'.");
     ok(thisVar.get("window").target.querySelector(".value").className.contains("token-other"),
       "Should have the right token class for 'window'.");
 
     is(thisVar.get("document").target.querySelector(".name").getAttribute("value"), "document",
       "Should have the right property name for 'document'.");
-    is(thisVar.get("document").target.querySelector(".value").getAttribute("value"), "HTMLDocument",
+    is(thisVar.get("document").target.querySelector(".value").getAttribute("value"),
+      "HTMLDocument \u2192 doc_frame-parameters.html",
       "Should have the right property value for 'document'.");
     ok(thisVar.get("document").target.querySelector(".value").className.contains("token-other"),
       "Should have the right token class for 'document'.");
 
     let argsProps = argsVar.target.querySelectorAll(".variables-view-property");
     is(argsProps.length, 8,
       "The 'arguments' variable should contain 5 enumerable and 3 non-enumerable properties");
 
diff --git a/browser/devtools/debugger/test/browser_dbg_variables-view-frame-parameters-02.js b/browser/devtools/debugger/test/browser_dbg_variables-view-frame-parameters-02.js
--- a/browser/devtools/debugger/test/browser_dbg_variables-view-frame-parameters-02.js
+++ b/browser/devtools/debugger/test/browser_dbg_variables-view-frame-parameters-02.js
@@ -51,17 +51,18 @@ function testScopeVariables() {
 
   is(localEnums.length, 12,
     "The local scope should contain all the created enumerable elements.");
   is(localNonEnums.length, 0,
     "The local scope should contain all the created non-enumerable elements.");
 
   is(localEnums[0].querySelector(".name").getAttribute("value"), "this",
     "Should have the right property name for 'this'.");
-  is(localEnums[0].querySelector(".value").getAttribute("value"), "Window",
+  is(localEnums[0].querySelector(".value").getAttribute("value"),
+    "Window \u2192 doc_frame-parameters.html",
     "Should have the right property value for 'this'.");
   ok(localEnums[0].querySelector(".value").className.contains("token-other"),
     "Should have the right token class for 'this'.");
 
   is(localEnums[1].querySelector(".name").getAttribute("value"), "aArg",
     "Should have the right property name for 'aArg'.");
   is(localEnums[1].querySelector(".value").getAttribute("value"), "Object",
     "Should have the right property value for 'aArg'.");
@@ -187,17 +188,18 @@ function testArgumentsProperties() {
       "Should have the right property name for '4'.");
     is(argsEnums[4].querySelector(".value").getAttribute("value"), "null",
       "Should have the right property name for '4'.");
     ok(argsEnums[4].querySelector(".value").className.contains("token-null"),
       "Should have the right token class for '4'.");
 
     is(argsNonEnums[0].querySelector(".name").getAttribute("value"), "callee",
      "Should have the right property name for 'callee'.");
-    is(argsNonEnums[0].querySelector(".value").getAttribute("value"), "Function",
+    is(argsNonEnums[0].querySelector(".value").getAttribute("value"),
+     "test(aArg,bArg,cArg,dArg,eArg,fArg)",
      "Should have the right property name for 'callee'.");
     ok(argsNonEnums[0].querySelector(".value").className.contains("token-other"),
      "Should have the right token class for 'callee'.");
 
     is(argsNonEnums[1].querySelector(".name").getAttribute("value"), "length",
       "Should have the right property name for 'length'.");
     is(argsNonEnums[1].querySelector(".value").getAttribute("value"), "5",
       "Should have the right property value for 'length'.");
@@ -513,24 +515,26 @@ function testGetterSetterObject() {
 
     is(propEnums.length, 0,
       "The propEnums should contain all the created enumerable elements.");
     is(propNonEnums.length, 2,
       "The propEnums should contain all the created non-enumerable elements.");
 
     is(propNonEnums[0].querySelector(".name").getAttribute("value"), "get",
       "Should have the right property name for 'get'.");
-    is(propNonEnums[0].querySelector(".value").getAttribute("value"), "Function",
+    is(propNonEnums[0].querySelector(".value").getAttribute("value"),
+      "test/myVar.prop()",
       "Should have the right property value for 'get'.");
     ok(propNonEnums[0].querySelector(".value").className.contains("token-other"),
       "Should have the right token class for 'get'.");
 
     is(propNonEnums[1].querySelector(".name").getAttribute("value"), "set",
       "Should have the right property name for 'set'.");
-    is(propNonEnums[1].querySelector(".value").getAttribute("value"), "Function",
+    is(propNonEnums[1].querySelector(".value").getAttribute("value"),
+      "test/myVar.prop(val)",
       "Should have the right property value for 'set'.");
     ok(propNonEnums[1].querySelector(".value").className.contains("token-other"),
       "Should have the right token class for 'set'.");
 
     deferred.resolve();
   });
 
   myVar.expand();
diff --git a/browser/devtools/debugger/test/browser_dbg_variables-view-frame-parameters-03.js b/browser/devtools/debugger/test/browser_dbg_variables-view-frame-parameters-03.js
--- a/browser/devtools/debugger/test/browser_dbg_variables-view-frame-parameters-03.js
+++ b/browser/devtools/debugger/test/browser_dbg_variables-view-frame-parameters-03.js
@@ -66,22 +66,24 @@ function testGlobalScope() {
 
   is(globalScope.get("SpecialPowers").target.querySelector(".name").getAttribute("value"), "SpecialPowers",
     "Should have the right property name for 'SpecialPowers'.");
   is(globalScope.get("SpecialPowers").target.querySelector(".value").getAttribute("value"), "Object",
     "Should have the right property value for 'SpecialPowers'.");
 
   is(globalScope.get("window").target.querySelector(".name").getAttribute("value"), "window",
     "Should have the right property name for 'window'.");
-  is(globalScope.get("window").target.querySelector(".value").getAttribute("value"), "Window",
+  is(globalScope.get("window").target.querySelector(".value").getAttribute("value"),
+    "Window \u2192 doc_frame-parameters.html",
     "Should have the right property value for 'window'.");
 
   is(globalScope.get("document").target.querySelector(".name").getAttribute("value"), "document",
     "Should have the right property name for 'document'.");
-  is(globalScope.get("document").target.querySelector(".value").getAttribute("value"), "HTMLDocument",
+  is(globalScope.get("document").target.querySelector(".value").getAttribute("value"),
+    "HTMLDocument \u2192 doc_frame-parameters.html",
     "Should have the right property value for 'document'.");
 
   is(globalScope.get("undefined").target.querySelector(".name").getAttribute("value"), "undefined",
     "Should have the right property name for 'undefined'.");
   is(globalScope.get("undefined").target.querySelector(".value").getAttribute("value"), "undefined",
     "Should have the right property value for 'undefined'.");
 
   is(globalScope.get("undefined").target.querySelector(".enum").childNodes.length, 0,
@@ -118,22 +120,24 @@ function testWindowVariable() {
 
   is(windowVar.get("SpecialPowers").target.querySelector(".name").getAttribute("value"), "SpecialPowers",
     "Should have the right property name for 'SpecialPowers'.");
   is(windowVar.get("SpecialPowers").target.querySelector(".value").getAttribute("value"), "Object",
     "Should have the right property value for 'SpecialPowers'.");
 
   is(windowVar.get("window").target.querySelector(".name").getAttribute("value"), "window",
     "Should have the right property name for 'window'.");
-  is(windowVar.get("window").target.querySelector(".value").getAttribute("value"), "Window",
+  is(windowVar.get("window").target.querySelector(".value").getAttribute("value"),
+    "Window \u2192 doc_frame-parameters.html",
     "Should have the right property value for 'window'.");
 
   is(windowVar.get("document").target.querySelector(".name").getAttribute("value"), "document",
     "Should have the right property name for 'document'.");
-  is(windowVar.get("document").target.querySelector(".value").getAttribute("value"), "HTMLDocument",
+  is(windowVar.get("document").target.querySelector(".value").getAttribute("value"),
+    "HTMLDocument \u2192 doc_frame-parameters.html",
     "Should have the right property value for 'document'.");
 
   is(windowVar.get("undefined").target.querySelector(".name").getAttribute("value"), "undefined",
     "Should have the right property name for 'undefined'.");
   is(windowVar.get("undefined").target.querySelector(".value").getAttribute("value"), "undefined",
     "Should have the right property value for 'undefined'.");
 
   is(windowVar.get("undefined").target.querySelector(".enum").childNodes.length, 0,
diff --git a/browser/devtools/debugger/test/browser_dbg_variables-view-frame-with.js b/browser/devtools/debugger/test/browser_dbg_variables-view-frame-with.js
--- a/browser/devtools/debugger/test/browser_dbg_variables-view-frame-with.js
+++ b/browser/devtools/debugger/test/browser_dbg_variables-view-frame-with.js
@@ -52,17 +52,18 @@ function testFirstWithScope() {
 
   is(withEnums.length, 3,
     "The first 'with' scope should contain all the created enumerable elements.");
   is(withNonEnums.length, 1,
     "The first 'with' scope should contain all the created non-enumerable elements.");
 
   is(withEnums[0].querySelector(".name").getAttribute("value"), "this",
     "Should have the right property name for 'this'.");
-  is(withEnums[0].querySelector(".value").getAttribute("value"), "Window",
+  is(withEnums[0].querySelector(".value").getAttribute("value"),
+    "Window \u2192 doc_with-frame.html",
     "Should have the right property value for 'this'.");
   ok(withEnums[0].querySelector(".value").className.contains("token-other"),
     "Should have the right token class for 'this'.");
 
   is(withEnums[1].querySelector(".name").getAttribute("value"), "one",
     "Should have the right property name for 'one'.");
   is(withEnums[1].querySelector(".value").getAttribute("value"), "1",
     "Should have the right property value for 'one'.");
@@ -126,17 +127,17 @@ function testSecondWithScope() {
     "Should have the right property name for 'PI'.");
   is(secondWithScope.get("PI").target.querySelector(".value").getAttribute("value"), "3.141592653589793",
     "Should have the right property value for 'PI'.");
   ok(secondWithScope.get("PI").target.querySelector(".value").className.contains("token-number"),
     "Should have the right token class for 'PI'.");
 
   is(secondWithScope.get("random").target.querySelector(".name").getAttribute("value"), "random",
     "Should have the right property name for 'random'.");
-  is(secondWithScope.get("random").target.querySelector(".value").getAttribute("value"), "Function",
+  is(secondWithScope.get("random").target.querySelector(".value").getAttribute("value"), "random()",
     "Should have the right property value for 'random'.");
   ok(secondWithScope.get("random").target.querySelector(".value").className.contains("token-other"),
     "Should have the right token class for 'random'.");
 
   is(secondWithScope.get("__proto__").target.querySelector(".name").getAttribute("value"), "__proto__",
     "Should have the right property name for '__proto__'.");
   is(secondWithScope.get("__proto__").target.querySelector(".value").getAttribute("value"), "Object",
     "Should have the right property value for '__proto__'.");
diff --git a/browser/devtools/debugger/test/browser_dbg_variables-view-large-array-buffer.js b/browser/devtools/debugger/test/browser_dbg_variables-view-large-array-buffer.js
--- a/browser/devtools/debugger/test/browser_dbg_variables-view-large-array-buffer.js
+++ b/browser/devtools/debugger/test/browser_dbg_variables-view-large-array-buffer.js
@@ -60,17 +60,17 @@ function performTest() {
     "Should have the right property name for 'buffer'.");
   is(bufferVar.target.querySelector(".value").getAttribute("value"), "ArrayBuffer",
     "Should have the right property value for 'buffer'.");
   ok(bufferVar.target.querySelector(".value").className.contains("token-other"),
     "Should have the right token class for 'buffer'.");
 
   is(zVar.target.querySelector(".name").getAttribute("value"), "z",
     "Should have the right property name for 'z'.");
-  is(zVar.target.querySelector(".value").getAttribute("value"), "Int8Array",
+  is(zVar.target.querySelector(".value").getAttribute("value"), "Int8Array[10000]",
     "Should have the right property value for 'z'.");
   ok(zVar.target.querySelector(".value").className.contains("token-other"),
     "Should have the right token class for 'z'.");
 
   EventUtils.sendMouseEvent({ type: "mousedown" },
     bufferVar.target.querySelector(".arrow"),
     gDebugger);
 
diff --git a/browser/devtools/debugger/test/browser_dbg_variables-view-webidl.js b/browser/devtools/debugger/test/browser_dbg_variables-view-webidl.js
--- a/browser/devtools/debugger/test/browser_dbg_variables-view-webidl.js
+++ b/browser/devtools/debugger/test/browser_dbg_variables-view-webidl.js
@@ -57,31 +57,32 @@ function performTest() {
   let globalScope = gVariables.getScopeAtIndex(1);
 
   let buttonVar = globalScope.get("button");
   let buttonAsProtoVar = globalScope.get("buttonAsProto");
   let documentVar = globalScope.get("document");
 
   is(buttonVar.target.querySelector(".name").getAttribute("value"), "button",
     "Should have the right property name for 'button'.");
-  is(buttonVar.target.querySelector(".value").getAttribute("value"), "HTMLButtonElement",
+  is(buttonVar.target.querySelector(".value").getAttribute("value"), "<button>",
     "Should have the right property value for 'button'.");
   ok(buttonVar.target.querySelector(".value").className.contains("token-other"),
     "Should have the right token class for 'button'.");
 
   is(buttonAsProtoVar.target.querySelector(".name").getAttribute("value"), "buttonAsProto",
     "Should have the right property name for 'buttonAsProto'.");
   is(buttonAsProtoVar.target.querySelector(".value").getAttribute("value"), "Object",
     "Should have the right property value for 'buttonAsProto'.");
   ok(buttonAsProtoVar.target.querySelector(".value").className.contains("token-other"),
     "Should have the right token class for 'buttonAsProto'.");
 
   is(documentVar.target.querySelector(".name").getAttribute("value"), "document",
     "Should have the right property name for 'document'.");
-  is(documentVar.target.querySelector(".value").getAttribute("value"), "HTMLDocument",
+  is(documentVar.target.querySelector(".value").getAttribute("value"),
+    "HTMLDocument \u2192 doc_frame-parameters.html",
     "Should have the right property value for 'document'.");
   ok(documentVar.target.querySelector(".value").className.contains("token-other"),
     "Should have the right token class for 'document'.");
 
   is(buttonVar.expanded, false,
     "The buttonVar should not be expanded at this point.");
   is(buttonAsProtoVar.expanded, false,
     "The buttonAsProtoVar should not be expanded at this point.");
@@ -93,38 +94,38 @@ function performTest() {
       "Should have the right property name for 'type'.");
     is(buttonVar.get("type").target.querySelector(".value").getAttribute("value"), "\"submit\"",
       "Should have the right property value for 'type'.");
     ok(buttonVar.get("type").target.querySelector(".value").className.contains("token-string"),
       "Should have the right token class for 'type'.");
 
     is(buttonVar.get("childNodes").target.querySelector(".name").getAttribute("value"), "childNodes",
       "Should have the right property name for 'childNodes'.");
-    is(buttonVar.get("childNodes").target.querySelector(".value").getAttribute("value"), "NodeList",
+    is(buttonVar.get("childNodes").target.querySelector(".value").getAttribute("value"), "NodeList[1]",
       "Should have the right property value for 'childNodes'.");
     ok(buttonVar.get("childNodes").target.querySelector(".value").className.contains("token-other"),
       "Should have the right token class for 'childNodes'.");
 
     is(buttonVar.get("onclick").target.querySelector(".name").getAttribute("value"), "onclick",
       "Should have the right property name for 'onclick'.");
-    is(buttonVar.get("onclick").target.querySelector(".value").getAttribute("value"), "Function",
+    is(buttonVar.get("onclick").target.querySelector(".value").getAttribute("value"), "onclick(event)",
       "Should have the right property value for 'onclick'.");
     ok(buttonVar.get("onclick").target.querySelector(".value").className.contains("token-other"),
       "Should have the right token class for 'onclick'.");
 
     is(documentVar.get("title").target.querySelector(".name").getAttribute("value"), "title",
       "Should have the right property name for 'title'.");
     is(documentVar.get("title").target.querySelector(".value").getAttribute("value"), "\"Debugger test page\"",
       "Should have the right property value for 'title'.");
     ok(documentVar.get("title").target.querySelector(".value").className.contains("token-string"),
       "Should have the right token class for 'title'.");
 
     is(documentVar.get("childNodes").target.querySelector(".name").getAttribute("value"), "childNodes",
       "Should have the right property name for 'childNodes'.");
-    is(documentVar.get("childNodes").target.querySelector(".value").getAttribute("value"), "NodeList",
+    is(documentVar.get("childNodes").target.querySelector(".value").getAttribute("value"), "NodeList[3]",
       "Should have the right property value for 'childNodes'.");
     ok(documentVar.get("childNodes").target.querySelector(".value").className.contains("token-other"),
       "Should have the right token class for 'childNodes'.");
 
     is(documentVar.get("onclick").target.querySelector(".name").getAttribute("value"), "onclick",
       "Should have the right property name for 'onclick'.");
     is(documentVar.get("onclick").target.querySelector(".value").getAttribute("value"), "null",
       "Should have the right property value for 'onclick'.");
@@ -139,17 +140,17 @@ function performTest() {
       "Should have the right property name for '__proto__'.");
     is(buttonProtoVar.target.querySelector(".value").getAttribute("value"), "HTMLButtonElementPrototype",
       "Should have the right property value for '__proto__'.");
     ok(buttonProtoVar.target.querySelector(".value").className.contains("token-other"),
       "Should have the right token class for '__proto__'.");
 
     is(buttonAsProtoProtoVar.target.querySelector(".name").getAttribute("value"), "__proto__",
       "Should have the right property name for '__proto__'.");
-    is(buttonAsProtoProtoVar.target.querySelector(".value").getAttribute("value"), "HTMLButtonElement",
+    is(buttonAsProtoProtoVar.target.querySelector(".value").getAttribute("value"), "<button>",
       "Should have the right property value for '__proto__'.");
     ok(buttonAsProtoProtoVar.target.querySelector(".value").className.contains("token-other"),
       "Should have the right token class for '__proto__'.");
 
     is(documentProtoVar.target.querySelector(".name").getAttribute("value"), "__proto__",
       "Should have the right property name for '__proto__'.");
     is(documentProtoVar.target.querySelector(".value").getAttribute("value"), "HTMLDocumentPrototype",
       "Should have the right property value for '__proto__'.");
@@ -168,24 +169,24 @@ function performTest() {
         "Should have the right property name for 'type'.");
       is(buttonAsProtoProtoVar.get("type").target.querySelector(".value").getAttribute("value"), "\"submit\"",
         "Should have the right property value for 'type'.");
       ok(buttonAsProtoProtoVar.get("type").target.querySelector(".value").className.contains("token-string"),
         "Should have the right token class for 'type'.");
 
       is(buttonAsProtoProtoVar.get("childNodes").target.querySelector(".name").getAttribute("value"), "childNodes",
         "Should have the right property name for 'childNodes'.");
-      is(buttonAsProtoProtoVar.get("childNodes").target.querySelector(".value").getAttribute("value"), "NodeList",
+      is(buttonAsProtoProtoVar.get("childNodes").target.querySelector(".value").getAttribute("value"), "NodeList[1]",
         "Should have the right property value for 'childNodes'.");
       ok(buttonAsProtoProtoVar.get("childNodes").target.querySelector(".value").className.contains("token-other"),
         "Should have the right token class for 'childNodes'.");
 
       is(buttonAsProtoProtoVar.get("onclick").target.querySelector(".name").getAttribute("value"), "onclick",
         "Should have the right property name for 'onclick'.");
-      is(buttonAsProtoProtoVar.get("onclick").target.querySelector(".value").getAttribute("value"), "Function",
+      is(buttonAsProtoProtoVar.get("onclick").target.querySelector(".value").getAttribute("value"), "onclick(event)",
         "Should have the right property value for 'onclick'.");
       ok(buttonAsProtoProtoVar.get("onclick").target.querySelector(".value").className.contains("token-other"),
         "Should have the right token class for 'onclick'.");
 
       let buttonProtoProtoVar = buttonProtoVar.get("__proto__");
       let buttonAsProtoProtoProtoVar = buttonAsProtoProtoVar.get("__proto__");
       let documentProtoProtoVar = documentProtoVar.get("__proto__");
 
diff --git a/browser/devtools/webconsole/test/browser_bug_865871_variables_view_close_on_esc_key.js b/browser/devtools/webconsole/test/browser_bug_865871_variables_view_close_on_esc_key.js
--- a/browser/devtools/webconsole/test/browser_bug_865871_variables_view_close_on_esc_key.js
+++ b/browser/devtools/webconsole/test/browser_bug_865871_variables_view_close_on_esc_key.js
@@ -31,17 +31,18 @@ function consoleOpened(hud)
 }
 
 function onExecuteFooObj(msg)
 {
   ok(msg, "output message found");
 
   let anchor = msg.querySelector("a");
   ok(anchor, "object anchor");
-  isnot(anchor.textContent.indexOf("[object Object]"), -1, "message text check");
+  isnot(anchor.textContent.indexOf('testProp: "testValue"'), -1,
+        "message text check");
 
   gJSTerm.once("variablesview-fetched", onFooObjFetch);
   EventUtils.synthesizeMouse(anchor, 2, 2, {}, gWebConsole.iframeWindow)
 }
 
 function onFooObjFetch(aEvent, aVar)
 {
   gVariablesView = aVar._variablesView;
@@ -71,17 +72,18 @@ function onSidebarClosed()
   gJSTerm.execute("window", onExecuteWindow);
 }
 
 function onExecuteWindow(msg)
 {
   ok(msg, "output message found");
   let anchor = msg.querySelector("a");
   ok(anchor, "object anchor");
-  isnot(anchor.textContent.indexOf("[object Window]"), -1, "message text check");
+  isnot(anchor.textContent.indexOf("Window \u2192 http://example.com/browser/"), -1,
+        "message text check");
 
   gJSTerm.once("variablesview-fetched", onWindowFetch);
   EventUtils.synthesizeMouse(anchor, 2, 2, {}, gWebConsole.iframeWindow)
 }
 
 function onWindowFetch(aEvent, aVar)
 {
   gVariablesView = aVar._variablesView;
diff --git a/browser/devtools/webconsole/test/browser_bug_869003_inspect_cross_domain_object.js b/browser/devtools/webconsole/test/browser_bug_869003_inspect_cross_domain_object.js
--- a/browser/devtools/webconsole/test/browser_bug_869003_inspect_cross_domain_object.js
+++ b/browser/devtools/webconsole/test/browser_bug_869003_inspect_cross_domain_object.js
@@ -41,17 +41,17 @@ function consoleOpened(hud)
     }],
   }).then(onConsoleMessage);
 }
 
 function onConsoleMessage(aResults)
 {
   let clickable = aResults[0].clickableElements[0];
   ok(clickable, "clickable object found");
-  isnot(clickable.textContent.indexOf("[object Object]"), -1,
+  isnot(clickable.textContent.indexOf('{hello: "world!",'), -1,
         "message text check");
 
   gJSTerm.once("variablesview-fetched", onObjFetch);
 
   EventUtils.synthesizeMouse(clickable, 2, 2, {}, gWebConsole.iframeWindow)
 }
 
 function onObjFetch(aEvent, aVar)
diff --git a/browser/devtools/webconsole/test/browser_console_consolejsm_output.js b/browser/devtools/webconsole/test/browser_console_consolejsm_output.js
--- a/browser/devtools/webconsole/test/browser_console_consolejsm_output.js
+++ b/browser/devtools/webconsole/test/browser_console_consolejsm_output.js
@@ -66,17 +66,17 @@ function test()
         {
           name: "console.warn output",
           text: "bug851231-warn",
           category: CATEGORY_WEBDEV,
           severity: SEVERITY_WARNING,
         },
         {
           name: "console.error output",
-          text: /\bbug851231-error\b.+\[object Object\]/,
+          text: /\bbug851231-error\b.+\{bug851231prop:\s"bug851231value"\}/,
           category: CATEGORY_WEBDEV,
           severity: SEVERITY_ERROR,
           objects: true,
         },
         {
           name: "console.debug output",
           text: "bug851231-debug",
           category: CATEGORY_WEBDEV,
@@ -86,17 +86,17 @@ function test()
           name: "console.trace output",
           consoleTrace: {
             file: "browser_console_consolejsm_output.js",
             fn: "onCachedMessage",
           },
         },
         {
           name: "console.dir output",
-          consoleDir: "[object XULDocument]",
+          consoleDir: "XULDocument {",
         },
         {
           name: "console.time output",
           consoleTime: "foobarTimer",
         },
         {
           name: "console.timeEnd output",
           consoleTimeEnd: "foobarTimer",
diff --git a/browser/devtools/webconsole/test/browser_console_log_inspectable_object.js b/browser/devtools/webconsole/test/browser_console_log_inspectable_object.js
--- a/browser/devtools/webconsole/test/browser_console_log_inspectable_object.js
+++ b/browser/devtools/webconsole/test/browser_console_log_inspectable_object.js
@@ -29,17 +29,17 @@ function performTest(hud)
       text: "fooBug676722",
       category: CATEGORY_WEBDEV,
       severity: SEVERITY_LOG,
       objects: true,
     }],
   }).then(([result]) => {
     let clickable = result.clickableElements[0];
     ok(clickable, "the console.log() object anchor was found");
-    isnot(clickable.textContent.indexOf("Object"), -1,
+    isnot(clickable.textContent.indexOf('{abba: "omgBug676722"}'), -1,
           "clickable node content is correct");
 
     hud.jsterm.once("variablesview-fetched",
       (aEvent, aVar) => {
         ok(aVar, "object inspector opened on click");
 
         findVariableViewProperties(aVar, [{
           name: "abba",
diff --git a/browser/devtools/webconsole/test/browser_console_native_getters.js b/browser/devtools/webconsole/test/browser_console_native_getters.js
--- a/browser/devtools/webconsole/test/browser_console_native_getters.js
+++ b/browser/devtools/webconsole/test/browser_console_native_getters.js
@@ -25,17 +25,17 @@ function consoleOpened(hud)
   gWebConsole = hud;
   gJSTerm = hud.jsterm;
 
   gJSTerm.execute("document");
 
   waitForMessages({
     webconsole: hud,
     messages: [{
-      text: "[object HTMLDocument]",
+      text: "HTMLDocument \u2192 data:text/html;charset=utf8",
       category: CATEGORY_OUTPUT,
       objects: true,
     }],
   }).then(onEvalResult);
 }
 
 function onEvalResult(aResults)
 {
@@ -85,17 +85,17 @@ function onFetchAfterBackgroundUpdate(aE
 
 function testParagraphs()
 {
   gJSTerm.execute("$$('p')");
 
   waitForMessages({
     webconsole: gWebConsole,
     messages: [{
-      text: "[object NodeList]",
+      text: "NodeList [",
       category: CATEGORY_OUTPUT,
       objects: true,
     }],
   }).then(onEvalNodeList);
 }
 
 function onEvalNodeList(aResults)
 {
diff --git a/browser/devtools/webconsole/test/browser_console_variables_view.js b/browser/devtools/webconsole/test/browser_console_variables_view.js
--- a/browser/devtools/webconsole/test/browser_console_variables_view.js
+++ b/browser/devtools/webconsole/test/browser_console_variables_view.js
@@ -23,17 +23,18 @@ function consoleOpened(hud)
   gWebConsole = hud;
   gJSTerm = hud.jsterm;
   gJSTerm.execute("fooObj", onExecuteFooObj);
 }
 
 function onExecuteFooObj(msg)
 {
   ok(msg, "output message found");
-  isnot(msg.textContent.indexOf("[object Object]"), -1, "message text check");
+  isnot(msg.textContent.indexOf('{testProp: "testValue"}'), -1,
+        "message text check");
 
   let anchor = msg.querySelector("a");
   ok(anchor, "object link found");
 
   gJSTerm.once("variablesview-fetched", onFooObjFetch);
 
   executeSoon(() =>
     EventUtils.synthesizeMouse(anchor, 2, 2, {}, gWebConsole.iframeWindow)
diff --git a/browser/devtools/webconsole/test/browser_console_variables_view_while_debugging.js b/browser/devtools/webconsole/test/browser_console_variables_view_while_debugging.js
--- a/browser/devtools/webconsole/test/browser_console_variables_view_while_debugging.js
+++ b/browser/devtools/webconsole/test/browser_console_variables_view_while_debugging.js
@@ -57,17 +57,18 @@ function onFramesAdded()
     )
   );
 }
 
 
 function onExecuteFooObj(msg)
 {
   ok(msg, "output message found");
-  isnot(msg.textContent.indexOf("[object Object]"), -1, "message text check");
+  isnot(msg.textContent.indexOf('{testProp2: "testValue2"}'), -1,
+        "message text check");
 
   let anchor = msg.querySelector("a");
   ok(anchor, "object link found");
 
   gJSTerm.once("variablesview-fetched", onFooObjFetch);
 
   executeSoon(() => EventUtils.synthesizeMouse(anchor, 2, 2, {},
                                                gWebConsole.iframeWindow));
diff --git a/browser/devtools/webconsole/test/browser_console_variables_view_while_debugging_and_inspecting.js b/browser/devtools/webconsole/test/browser_console_variables_view_while_debugging_and_inspecting.js
--- a/browser/devtools/webconsole/test/browser_console_variables_view_while_debugging_and_inspecting.js
+++ b/browser/devtools/webconsole/test/browser_console_variables_view_while_debugging_and_inspecting.js
@@ -52,17 +52,18 @@ function onFramesAdded()
   info("onFramesAdded");
 
   openConsole(null, () => gJSTerm.execute("fooObj", onExecuteFooObj));
 }
 
 function onExecuteFooObj(msg)
 {
   ok(msg, "output message found");
-  isnot(msg.textContent.indexOf("[object Object]"), -1, "message text check");
+  isnot(msg.textContent.indexOf('{testProp2: "testValue2"}'), -1,
+        "message text check");
 
   let anchor = msg.querySelector("a");
   ok(anchor, "object link found");
 
   gJSTerm.once("variablesview-fetched", onFooObjFetch);
 
   EventUtils.synthesizeMouse(anchor, 2, 2, {}, gWebConsole.iframeWindow);
 }
diff --git a/browser/devtools/webconsole/test/browser_jsterm_inspect.js b/browser/devtools/webconsole/test/browser_jsterm_inspect.js
--- a/browser/devtools/webconsole/test/browser_jsterm_inspect.js
+++ b/browser/devtools/webconsole/test/browser_jsterm_inspect.js
@@ -24,12 +24,12 @@ function test()
   }
 
   function onObjFetch(aEvent, aVar)
   {
     ok(aVar._variablesView, "variables view object");
 
     findVariableViewProperties(aVar, [
       { name: "testProp", value: "testValue" },
-      { name: "document", value: "HTMLDocument" },
+      { name: "document", value: /HTMLDocument \u2192 data:/ },
     ], { webconsole: hud }).then(finishTest);
   }
 }
diff --git a/browser/devtools/webconsole/test/browser_result_format_as_string.js b/browser/devtools/webconsole/test/browser_result_format_as_string.js
--- a/browser/devtools/webconsole/test/browser_result_format_as_string.js
+++ b/browser/devtools/webconsole/test/browser_result_format_as_string.js
@@ -23,19 +23,19 @@ function performTest(hud)
   hud.jsterm.clearOutput(true);
 
   hud.jsterm.execute("document.querySelector('p')", (msg) => {
     is(hud.outputNode.textContent.indexOf("bug772506_content"), -1,
        "no content element found");
     ok(!hud.outputNode.querySelector("#foobar"), "no #foobar element found");
 
     ok(msg, "eval output node found");
-    is(msg.textContent.indexOf("HTMLDivElement"), -1,
-       "HTMLDivElement string is not displayed");
-    isnot(msg.textContent.indexOf("HTMLParagraphElement"), -1,
-          "HTMLParagraphElement string is displayed");
+    is(msg.textContent.indexOf("<div>"), -1,
+       "<div> string is not displayed");
+    isnot(msg.textContent.indexOf("<p>"), -1,
+          "<p> string is displayed");
 
     EventUtils.synthesizeMouseAtCenter(msg, {type: "mousemove"});
     ok(!gBrowser._bug772506, "no content variable");
 
     finishTest();
   });
 }
diff --git a/browser/devtools/webconsole/test/browser_webconsole_bug_598357_jsterm_output.js b/browser/devtools/webconsole/test/browser_webconsole_bug_598357_jsterm_output.js
--- a/browser/devtools/webconsole/test/browser_webconsole_bug_598357_jsterm_output.js
+++ b/browser/devtools/webconsole/test/browser_webconsole_bug_598357_jsterm_output.js
@@ -1,267 +1,502 @@
-/* vim:set ts=2 sw=2 sts=2 et: */
-/* ***** BEGIN LICENSE BLOCK *****
+/*
  * Any copyright is dedicated to the Public Domain.
  * http://creativecommons.org/publicdomain/zero/1.0/
- *
- * Contributor(s):
- *  Mihai È˜ucan <mihai.sucan@gmail.com>
- *
- * ***** END LICENSE BLOCK ***** */
+ */
 
 const TEST_URI = "http://example.com/browser/browser/devtools/webconsole/test/test-console.html";
 
-let testEnded = false;
-let pos = -1;
+let dateNow = Date.now();
+let DebuggerServer = Cu.import("resource://gre/modules/devtools/dbg-server.jsm", {}).DebuggerServer;
+let longString = (new Array(DebuggerServer.LONG_STRING_LENGTH + 4)).join("a");
+let initialString = longString.substring(0, DebuggerServer.LONG_STRING_INITIAL_LENGTH);
+DebuggerServer = null;
 
-let dateNow = Date.now();
+// Each input test object has the following properties:
+//
+// - input: string, JS input value to execute.
+//
+// - output: string, expected JS eval result.
+//
+// - inspectable: boolean, tells if the result is expected to be an object you
+// can click on to inspect.
+//
+// - printOutput: string, optional, expected output for |print(input)|. If this
+// is not provided, printOutput = output.
+//
+// - consoleLogInput: string, optional, JS input value to use for the
+// console.log() call. If this is not provided, then |input| is used,
+// |console.log(input)|.
+//
+// - consoleLogOutput: string, optional, expected output for
+// |console.log(consoleLogInput)|. If this is not provided, consoleLogOutput
+// = output.
 
-let tempScope = {};
-Cu.import("resource://gre/modules/devtools/dbg-server.jsm", tempScope);
-
-let longString = (new Array(tempScope.DebuggerServer.LONG_STRING_LENGTH + 4)).join("a");
-let initialString = longString.substring(0,
-  tempScope.DebuggerServer.LONG_STRING_INITIAL_LENGTH);
-
-let inputValues = [
-  // [showsVariablesView?, input value, expected output format,
-  //    print() output, console API output, optional console API test]
-
+let inputTests = [
   // 0
-  [false, "'hello \\nfrom \\rthe \\\"string world!'",
-    '"hello \nfrom \rthe "string world!"',
-    "hello \nfrom \rthe \"string world!"],
+  {
+    input: "'hello \\nfrom \\rthe \\\"string world!'",
+    output: "\"hello \\nfrom \\rthe \\\"string world!\"",
+  },
 
   // 1
-  [false, "'\xFA\u1E47\u0129\xE7\xF6d\xEA \u021B\u0115\u0219\u0165'",
-    "\"\xFA\u1E47\u0129\xE7\xF6d\xEA \u021B\u0115\u0219\u0165\"",
-    "\xFA\u1E47\u0129\xE7\xF6d\xEA \u021B\u0115\u0219\u0165"],
+  {
+    // unicode test
+    input: "'\xFA\u1E47\u0129\xE7\xF6d\xEA \u021B\u0115\u0219\u0165'",
+    output: "\"\\xFA\\u1E47\\u0129\\xE7\\xF6d\\xEA \\u021B\\u0115\\u0219\\u0165\"",
+  },
 
   // 2
-  [false, "window.location.href", '"' + TEST_URI + '"', TEST_URI],
+  {
+    input: "window.location.href",
+    output: '"' + TEST_URI + '"',
+  },
 
   // 3
-  [false, "0", "0"],
+  {
+    input: "0",
+    output: "0",
+  },
 
   // 4
-  [false, "'0'", '"0"', "0"],
+  {
+    input: "'0'",
+    output: '"0"',
+  },
 
   // 5
-  [false, "42", "42"],
+  {
+    input: "42",
+    output: "42",
+  },
 
   // 6
-  [false, "'42'", '"42"', "42"],
+  {
+    input: "'42'",
+    output: '"42"',
+  },
 
   // 7
-  [true, "/foobar/", "[object RegExp]", '"/foobar/"', "[object RegExp]"],
+  {
+    input: "/foobar/",
+    output: "/foobar/",
+    inspectable: true,
+  },
 
   // 8
-  [false, "null", "null"],
+  {
+    input: "null",
+    output: "null",
+  },
 
   // 9
-  [false, "undefined", "undefined"],
+  {
+    input: "undefined",
+    output: "undefined",
+  },
 
   // 10
-  [false, "true", "true"],
+  {
+    input: "true",
+    output: "true",
+  },
 
   // 11
-  [true, "document.getElementById", "[object Function]",
-    "function getElementById() {\n    [native code]\n}",
-    "[object Function]"],
+  {
+    input: "document.getElementById",
+    output: "function getElementById()",
+    printOutput: "function getElementById() {\\n    [native code]\\n}",
+    inspectable: true,
+    variablesViewLabel: "getElementById()",
+  },
 
   // 12
-  [true, "(function() { return 42; })", "[object Function]",
-    "function () { return 42; }", "[object Function]"],
+  {
+    input: "(function() { return 42; })",
+    output: "function ()",
+    printOutput: "function () { return 42; }",
+    inspectable: true,
+  },
 
   // 13
-  [true, "new Date(" + dateNow + ")", "[object Date]", (new Date(dateNow)).toString(), "[object Date]"],
+  {
+    input: "new Date(" + dateNow + ")",
+    output: "Date " + (new Date(dateNow)).toISOString(),
+    printOutput: (new Date(dateNow)).toString(),
+    inspectable: true,
+  },
 
   // 14
-  [true, "document.body", "[object HTMLBodyElement]"],
+  {
+    input: "document.body",
+    output: "<body>",
+    printOutput: "[object HTMLBodyElement]",
+    inspectable: true,
+  },
 
   // 15
-  [true, "window.location", "[object Location]", TEST_URI, "[object Location]"],
+  {
+    input: "window.location",
+    output: "Location \u2192 " + TEST_URI,
+    printOutput: TEST_URI,
+    inspectable: true,
+    variablesViewLabel: "Location \u2192 test-console.html",
+  },
 
   // 16
-  [true, "[1,2,3,'a','b','c','4','5']", '[object Array]',
-    '1,2,3,a,b,c,4,5',
-    "[object Array]"],
+  {
+    input: "[1,2,3,'a','b','c','4','5']",
+    output: '[1, 2, 3, "a", "b", "c", "4", "5"]',
+    printOutput: "1,2,3,a,b,c,4,5",
+    inspectable: true,
+    variablesViewLabel: "Array[8]",
+  },
 
   // 17
-  [true, "({a:'b', c:'d', e:1, f:'2'})", "[object Object]"],
+  {
+    input: "({a:'b', c:'d', e:1, f:'2'})",
+    output: '{a: "b", c: "d", e: 1, f: "2"}',
+    printOutput: "[object Object]",
+    inspectable: true,
+    variablesViewLabel: "Object",
+  },
 
   // 18
-  [false, "'" + longString + "'",
-    '"' + initialString + "\"[\u2026]", initialString],
+  {
+    input: "'" + longString + "'",
+    output: '"' + initialString + "\"[\u2026]",
+    printOutput: initialString,
+  },
+
+  // 19
+  {
+    input: "/foo?b*\\s\"ar/igym",
+    output: "/foo?b*\\s\"ar/gimy",
+    printOutput: "/foo?b*\\\\s\\\"ar/gimy",
+    inspectable: true,
+  },
+
+  // 20
+  {
+    input: "false",
+    output: "false",
+  },
+
+  // 21
+  {
+    input: "new Date('test')",
+    output: "Invalid Date",
+    printOutput: "Invalid Date",
+    inspectable: true,
+    variablesViewLabel: "Invalid Date",
+  },
+
+  // 22
+  {
+    input: "(function zoom() { return 42; })",
+    output: "function zoom()",
+    printOutput: "function zoom() { return 42; }",
+    inspectable: true,
+    variablesViewLabel: "zoom()",
+  },
+
+  // 23
+  {
+    input: "(function() { var obj = { test: function() { return 42; } };" +
+           "return obj.test; })()",
+    output: "function obj.test()",
+    printOutput: "function () { return 42; }",
+    inspectable: true,
+    variablesViewLabel: "obj.test()",
+  },
+
+  // 24
+  {
+    input: "(function() { document.body.className = 'test1 tezt2';" +
+           "return document.body; })()",
+    output: '<body class="test1 tezt2">',
+    printOutput: "[object HTMLBodyElement]",
+    inspectable: true,
+    variablesViewLabel: "<body>",
+  },
+
+  // 25
+  {
+    input: "(function() { document.body.id = 'foobarid';" +
+           "return document.body; })()",
+    output: '<body class="test1 tezt2" id="foobarid">',
+    printOutput: "[object HTMLBodyElement]",
+    inspectable: true,
+    variablesViewLabel: "<body#foobarid>",
+  },
+
+  // 26
+  {
+    input: "document.body.classList",
+    output: 'DOMTokenList ["test1", "tezt2"]',
+    printOutput: '"test1 tezt2"',
+    inspectable: true,
+    variablesViewLabel: "DOMTokenList[2]",
+  },
+
+  // 27
+  {
+    input: "document.body.dataset",
+    output: "DOMStringMap {}",
+    printOutput: "[object DOMStringMap]",
+    inspectable: true,
+    variablesViewLabel: "DOMStringMap[0]",
+  },
+
+  // 28
+  {
+    input: '(function() { document.body.dataset.preview = \'zuzu"<a>foo\';' +
+           "return document.body; })()",
+    output: '<body class="test1 tezt2" id="foobarid"' +
+            ' data-preview="zuzu&quot;&lt;a&gt;foo">',
+    printOutput: "[object HTMLBodyElement]",
+    inspectable: true,
+    variablesViewLabel: "<body#foobarid>",
+  },
+
+  // 29
+  {
+    input: "document.body.dataset",
+    output: 'DOMStringMap {preview: "zuzu\\"<a>foo"}',
+    printOutput: "[object DOMStringMap]",
+    inspectable: true,
+    variablesViewLabel: "DOMStringMap[1]",
+  },
+
+  // 30
+  {
+    input: "['a', document, document.body, document.body.dataset," +
+           "document.body.classList]",
+    output: '["a", HTMLDocument \u2192 test-console.html, <body#foobarid>, ' +
+            "DOMStringMap[1], DOMTokenList[2]]",
+    printOutput: '"a,[object HTMLDocument],[object HTMLBodyElement],' +
+                 '[object DOMStringMap],test1 tezt2"',
+    inspectable: true,
+    variablesViewLabel: "Array[5]",
+  },
+
+  // 31
+  {
+    input: "document",
+    output: "HTMLDocument \u2192 " + TEST_URI,
+    printOutput: '[object HTMLDocument]',
+    inspectable: true,
+    variablesViewLabel: "HTMLDocument \u2192 test-console.html",
+  },
+
+  // 32
+  {
+    input: "window",
+    output: "Window \u2192 " + TEST_URI,
+    printOutput: '[object Window]',
+    inspectable: true,
+    variablesViewLabel: "Window \u2192 test-console.html",
+  },
+
+  // 33
+  {
+    input: "[1,2,3,'a','b','c','4','5','6','7','8',9,10]",
+    output: '[1, 2, 3, "a", "b", "c", "4", "5", "6", "7", 3 more\u2026]',
+    printOutput: "1,2,3,a,b,c,4,5,6,7,8,9,10",
+    inspectable: true,
+    variablesViewLabel: "Array[13]",
+  },
+
+  // 34
+  {
+    input: "(function() { var ar = new Array(5); ar.push('test'); return ar; })()",
+    output: '[,,,,, "test"]',
+    printOutput: ",,,,,test",
+    inspectable: true,
+    variablesViewLabel: "Array[6]",
+  },
+
+  // 35
+  {
+    input: "({a:'b', c:'d', e:1, f:'2', g:true, h:null, i:undefined," +
+           "j:'', k:document.styleSheets, l:document.body.childNodes, " +
+           "o:new Array(125), m:document.head})",
+    output: '{a: "b", c: "d", e: 1, f: "2", g: true, h: null, i: undefined, ' +
+            'j: "", k: StyleSheetList[0], l: NodeList[7], 2 more\u2026}',
+    printOutput: "[object Object]",
+    inspectable: true,
+    variablesViewLabel: "Object",
+  },
+
+  // 36
+  {
+    input: "document.body.attributes",
+    output: 'MozNamedAttrMap [class="test1 tezt2", id="foobarid", ' +
+            'data-preview="zuzu&quot;&lt;a&gt;foo"]',
+    printOutput: "[object MozNamedAttrMap]",
+    inspectable: true,
+    variablesViewLabel: "MozNamedAttrMap[3]",
+  },
+
+  // 37
+  {
+    input: "document.body.attributes[0]",
+    output: 'class="test1 tezt2"',
+    printOutput: "[object Attr]",
+    inspectable: true,
+    variablesViewLabel: 'class="test1 tezt2"',
+  },
+
+  // 38
+  {
+    input: "(function() { var test = function() { return 42; };" +
+           "test.displayName = 'foofn'; return test; })()",
+    output: "function foofn()",
+    printOutput: "function () { return 42; }",
+    inspectable: true,
+    variablesViewLabel: "foofn()",
+  },
+
+  // 39
+  {
+    input: "new Set([1,2,'a','b',undefined,document.head])",
+    output: 'Set [1, 2, "a", "b", undefined, <head>]',
+    printOutput: "[object Set]",
+    inspectable: true,
+    variablesViewLabel: "Set[6]",
+  },
+
+  // 40
+  {
+    input: "new Map([['a', 'b'], [document.body.children, {'foo': 'bar'}]])",
+    output: 'Map {a: "b", HTMLCollection[3]: Object}',
+    printOutput: "[object Map]",
+    inspectable: true,
+    variablesViewLabel: "Map[2]",
+  },
+
+  // 41
+  {
+    input: "new Int32Array([1,287,8651,40983,8754])",
+    output: 'Int32Array [1, 287, 8651, 40983, 8754]',
+    printOutput: "[object Int32Array]",
+    inspectable: true,
+    variablesViewLabel: "Int32Array[5]",
+  },
 ];
 
-longString = null;
-initialString = null;
-tempScope = null;
+longString = initialString = null;
 
-let eventHandlers = [];
-let popupShown = [];
-let HUD;
-let testDriver;
+function test() {
+  let hud;
+  let eventHandlers = new Set();
 
-function tabLoad(aEvent) {
-  browser.removeEventListener(aEvent.type, tabLoad, true);
+  requestLongerTimeout(2);
 
-  waitForFocus(function () {
-    openConsole(null, function(aHud) {
-      HUD = aHud;
-      testNext();
-    });
-  }, content);
-}
+  addTab(TEST_URI);
+  browser.addEventListener("load", function onLoad() {
+    browser.removeEventListener("load", onLoad, true);
+    Task.spawn(runner);
+  }, true);
 
-function subtestNext() {
-  testDriver.next();
-}
+  function runner()
+  {
+    hud = yield openConsole();
+    for (let [i, entry] of inputTests.entries()) {
+      yield checkInput(i, entry);
+    }
 
-function testNext() {
-  pos++;
-  if (pos == inputValues.length) {
-    testEnd();
-    return;
+    for (let fn of eventHandlers) {
+      hud.jsterm.off("variablesview-open", fn);
+    }
+
+    inputTests = null;
+    finishTest();
   }
 
-  testDriver = testGen();
-  testDriver.next();
-}
+  function checkInput(i, entry)
+  {
+    info("checkInput(" + i + "): " + entry.input);
+    hud.jsterm.clearOutput();
 
-function testGen() {
-  let cpos = pos;
+    // Test the console.log() output.
 
-  let showsVariablesView = inputValues[cpos][0];
-  let inputValue = inputValues[cpos][1];
-  let expectedOutput = inputValues[cpos][2];
+    let consoleLogInput = entry.consoleLogInput || entry.input;
+    let consoleLogOutput = entry.consoleLogOutput || entry.output;
+    hud.jsterm.execute("console.log(" + consoleLogInput + ")");
 
-  let printOutput = inputValues[cpos].length >= 4 ?
-    inputValues[cpos][3] : expectedOutput;
+    yield waitForMessages({
+      webconsole: hud,
+      messages: [{
+        name: "console.log() output: " + consoleLogOutput,
+        text: consoleLogOutput,
+        category: CATEGORY_WEBDEV,
+        severity: SEVERITY_LOG,
+      }],
+    });
 
-  let consoleOutput = inputValues[cpos].length >= 5 ?
-    inputValues[cpos][4] : printOutput;
+    hud.jsterm.clearOutput();
 
-  let consoleTest = inputValues[cpos][5] || inputValue;
+    // Test jsterm print() output.
 
-  HUD.jsterm.clearOutput();
+    let printOutput = entry.printOutput || entry.output;
+    hud.jsterm.execute("print(" + entry.input + ")");
 
-  // Test the console.log() output.
+    yield waitForMessages({
+      webconsole: hud,
+      messages: [{
+        name: "print() output: " + printOutput,
+        text: printOutput,
+        category: CATEGORY_OUTPUT,
+      }],
+    });
 
-  let outputItem;
-  function onExecute(msg) {
-    outputItem = msg;
-    subtestNext();
-  }
+    // Test jsterm execution output.
 
-  HUD.jsterm.execute("console.log(" + consoleTest + ")");
+    hud.jsterm.clearOutput();
+    hud.jsterm.execute(entry.input);
 
-  waitForMessages({
-    webconsole: HUD,
-    messages: [{
-      name: "console API output is correct for inputValues[" + cpos + "]",
-      text: consoleOutput,
-      category: CATEGORY_WEBDEV,
-      severity: SEVERITY_LOG,
-    }],
-  }).then(subtestNext);
+    let [result] = yield waitForMessages({
+      webconsole: hud,
+      messages: [{
+        name: "JS eval output: " + entry.output,
+        text: entry.output,
+        category: CATEGORY_OUTPUT,
+      }],
+    });
 
-  yield undefined;
+    let msg = [...result.matched][0];
+    let body = msg.querySelector(".body a") || msg.querySelector(".body");
+    ok(body, "the message body");
 
-  HUD.jsterm.clearOutput();
+    // Test click on output.
+    let deferred = promise.defer();
 
-  // Test jsterm print() output.
+    let variablesViewShown = function(aEvent, aView, aOptions) {
+      let label = entry.variablesViewLabel || entry.output;
+      if (aOptions.label != label) {
+        return;
+      }
 
-  HUD.jsterm.setInputValue("print(" + inputValue + ")");
-  HUD.jsterm.execute(null, onExecute);
+      hud.jsterm.off("variablesview-open", variablesViewShown);
 
-  yield undefined;
+      eventHandlers.delete(variablesViewShown);
 
-  ok(outputItem,
-    "found the jsterm print() output line for inputValues[" + cpos + "]");
-  ok(outputItem.textContent.indexOf(printOutput) > -1,
-    "jsterm print() output is correct for inputValues[" + cpos + "]");
+      ok(entry.inspectable, "variables view was shown");
 
-  // Test jsterm execution output.
+      if (entry.inspectable) {
+        deferred.resolve(null);
+      }
+    };
 
-  HUD.jsterm.clearOutput();
-  HUD.jsterm.setInputValue(inputValue);
-  HUD.jsterm.execute(null, onExecute);
+    hud.jsterm.on("variablesview-open", variablesViewShown);
 
-  yield undefined;
+    eventHandlers.add(variablesViewShown);
 
-  ok(outputItem, "found the jsterm output line for inputValues[" + cpos + "]");
-  ok(outputItem.textContent.indexOf(expectedOutput) > -1,
-    "jsterm output is correct for inputValues[" + cpos + "]");
+    EventUtils.synthesizeMouse(body, 2, 2, {}, hud.iframeWindow);
 
-  let messageBody = outputItem.querySelector(".body a") ||
-                    outputItem.querySelector(".body");
-  ok(messageBody, "we have the message body for inputValues[" + cpos + "]");
-
-  // Test click on output.
-  let eventHandlerID = eventHandlers.length + 1;
-
-  let variablesViewShown = function(aEvent, aView, aOptions) {
-    if (aOptions.label.indexOf(expectedOutput) == -1) {
-      return;
-    }
-
-    HUD.jsterm.off("variablesview-open", variablesViewShown);
-
-    eventHandlers[eventHandlerID] = null;
-
-    ok(showsVariablesView,
-      "the variables view shown for inputValues[" + cpos + "]");
-
-    popupShown[cpos] = true;
-
-    if (showsVariablesView) {
-      executeSoon(subtestNext);
-    }
-  };
-
-  HUD.jsterm.on("variablesview-open", variablesViewShown);
-
-  eventHandlers.push(variablesViewShown);
-
-  EventUtils.synthesizeMouse(messageBody, 2, 2, {}, HUD.iframeWindow);
-
-  if (showsVariablesView) {
-    info("messageBody tagName '" + messageBody.tagName +  "' className '" + messageBody.className + "'");
-    yield undefined; // wait for the panel to open if we need to.
-  }
-
-  testNext();
-
-  yield undefined;
-}
-
-function testEnd() {
-  if (testEnded) {
-    return;
-  }
-
-  testEnded = true;
-
-  for (let i = 0; i < eventHandlers.length; i++) {
-    if (eventHandlers[i]) {
-      HUD.jsterm.off("variablesview-open", eventHandlers[i]);
+    if (entry.inspectable) {
+      info("message body tagName '" + body.tagName +  "' className '" + body.className + "'");
+      yield deferred.promise; // wait for the panel to open if we need to.
     }
   }
-
-  for (let i = 0; i < inputValues.length; i++) {
-    if (inputValues[i][0] && !popupShown[i]) {
-      ok(false, "the variables view failed to show for inputValues[" + i + "]");
-    }
-  }
-
-  HUD = inputValues = testDriver = null;
-  executeSoon(finishTest);
 }
-
-function test() {
-  requestLongerTimeout(2);
-  addTab(TEST_URI);
-  browser.addEventListener("load", tabLoad, true);
-}
-
diff --git a/browser/devtools/webconsole/test/browser_webconsole_bug_651501_document_body_autocomplete.js b/browser/devtools/webconsole/test/browser_webconsole_bug_651501_document_body_autocomplete.js
--- a/browser/devtools/webconsole/test/browser_webconsole_bug_651501_document_body_autocomplete.js
+++ b/browser/devtools/webconsole/test/browser_webconsole_bug_651501_document_body_autocomplete.js
@@ -52,42 +52,37 @@ function autocompletePopupHidden()
   let jsterm = gHUD.jsterm;
   let popup = jsterm.autocompletePopup;
   let completeNode = jsterm.completeNode;
   let inputNode = jsterm.inputNode;
 
   popup._panel.removeEventListener("popuphidden", autocompletePopupHidden, false);
 
   ok(!popup.isOpen, "popup is not open");
+
+  jsterm.once("autocomplete-updated", function() {
+    is(completeNode.value, testStr + "dy", "autocomplete shows document.body");
+    testPropertyPanel();
+  });
+
   let inputStr = "document.b";
   jsterm.setInputValue(inputStr);
   EventUtils.synthesizeKey("o", {});
   let testStr = inputStr.replace(/./g, " ") + " ";
-
-  waitForSuccess({
-    name: "autocomplete shows document.body",
-    validatorFn: function()
-    {
-      return completeNode.value == testStr + "dy";
-    },
-    successFn: testPropertyPanel,
-    failureFn: finishTest,
-  });
 }
 
 function testPropertyPanel()
 {
   let jsterm = gHUD.jsterm;
   jsterm.clearOutput();
   jsterm.execute("document", (msg) => {
     jsterm.once("variablesview-fetched", onVariablesViewReady);
     let anchor = msg.querySelector(".body a");
     EventUtils.synthesizeMouse(anchor, 2, 2, {}, gHUD.iframeWindow);
   });
 }
 
 function onVariablesViewReady(aEvent, aView)
 {
   findVariableViewProperties(aView, [
-    { name: "body", value: "HTMLBodyElement" },
+    { name: "body", value: "<body>" },
   ], { webconsole: gHUD }).then(finishTest);
 }
-
diff --git a/browser/devtools/webconsole/test/browser_webconsole_bug_653531_highlighter_console_helper.js b/browser/devtools/webconsole/test/browser_webconsole_bug_653531_highlighter_console_helper.js
--- a/browser/devtools/webconsole/test/browser_webconsole_bug_653531_highlighter_console_helper.js
+++ b/browser/devtools/webconsole/test/browser_webconsole_bug_653531_highlighter_console_helper.js
@@ -83,18 +83,17 @@ function performWebConsoleTests(hud)
   let jsterm = hud.jsterm;
   outputNode = hud.outputNode;
 
   jsterm.clearOutput();
   jsterm.execute("$0", onNodeOutput);
 
   function onNodeOutput(node)
   {
-    isnot(node.textContent.indexOf("[object HTMLHeadingElement"), -1,
-          "correct output for $0");
+    isnot(node.textContent.indexOf("<h1>"), -1, "correct output for $0");
 
     jsterm.clearOutput();
     jsterm.execute("$0.textContent = 'bug653531'", onNodeUpdate);
   }
 
   function onNodeUpdate(node)
   {
     isnot(node.textContent.indexOf("bug653531"), -1,
diff --git a/browser/devtools/webconsole/test/browser_webconsole_bug_659907_console_dir.js b/browser/devtools/webconsole/test/browser_webconsole_bug_659907_console_dir.js
--- a/browser/devtools/webconsole/test/browser_webconsole_bug_659907_console_dir.js
+++ b/browser/devtools/webconsole/test/browser_webconsole_bug_659907_console_dir.js
@@ -17,13 +17,13 @@ function test() {
 
 function consoleOpened(hud) {
   hud.jsterm.execute("console.dir(document)");
   hud.jsterm.once("variablesview-fetched", testConsoleDir.bind(null, hud));
 }
 
 function testConsoleDir(hud, ev, view) {
   findVariableViewProperties(view, [
-    { name: "__proto__.__proto__.querySelectorAll", value: "Function" },
-    { name: "location", value: "Location" },
-    { name: "__proto__.write", value: "Function" },
+    { name: "__proto__.__proto__.querySelectorAll", value: "querySelectorAll()" },
+    { name: "location", value: /Location \u2192 data:Web/ },
+    { name: "__proto__.write", value: "write()" },
   ], { webconsole: hud }).then(finishTest);
 }
diff --git a/browser/devtools/webconsole/test/browser_webconsole_closure_inspection.js b/browser/devtools/webconsole/test/browser_webconsole_closure_inspection.js
--- a/browser/devtools/webconsole/test/browser_webconsole_closure_inspection.js
+++ b/browser/devtools/webconsole/test/browser_webconsole_closure_inspection.js
@@ -49,17 +49,17 @@ function consoleOpened(hud)
 {
   gWebConsole = hud;
   gJSTerm = hud.jsterm;
   gJSTerm.execute("window.george.getName");
 
   waitForMessages({
     webconsole: gWebConsole,
     messages: [{
-      text: "[object Function]",
+      text: "function _pfactory/<.getName()",
       category: CATEGORY_OUTPUT,
       objects: true,
     }],
   }).then(onExecuteGetName);
 }
 
 function onExecuteGetName(aResults)
 {
diff --git a/browser/devtools/webconsole/test/browser_webconsole_jsterm.js b/browser/devtools/webconsole/test/browser_webconsole_jsterm.js
--- a/browser/devtools/webconsole/test/browser_webconsole_jsterm.js
+++ b/browser/devtools/webconsole/test/browser_webconsole_jsterm.js
@@ -113,17 +113,17 @@ function testJSTerm(hud)
 
   let output = jsterm.outputNode.querySelector(".message[category='output']");
   ok(!output, "no output for help() calls");
   is(openedLinks, 3, "correct number of pages opened by the help calls");
   hud.openLink = oldOpenLink;
 
   jsterm.clearOutput();
   jsterm.execute("pprint({b:2, a:1})");
-  checkResult('"  b: 2\n  a: 1"', "pprint()");
+  checkResult("\"  b: 2\\n  a: 1\"", "pprint()");
   yield undefined;
 
   // check instanceof correctness, bug 599940
   jsterm.clearOutput();
   jsterm.execute("[] instanceof Array");
   checkResult("true", "[] instanceof Array == true");
   yield undefined;
 
@@ -149,17 +149,17 @@ function testJSTerm(hud)
   jsterm.clearOutput();
   jsterm.execute("keys(window)");
   checkResult(null, "keys(window)");
   yield undefined;
 
   // bug 614561
   jsterm.clearOutput();
   jsterm.execute("pprint('hi')");
-  checkResult('"  0: "h"\n  1: "i""', "pprint('hi')");
+  checkResult("\"  0: \\\"h\\\"\\n  1: \\\"i\\\"\"", "pprint('hi')");
   yield undefined;
 
   // check that pprint(function) shows function source, bug 618344
   jsterm.clearOutput();
   jsterm.execute("pprint(print)");
   checkResult(function(node) {
     return node.textContent.indexOf("aOwner.helperResult") > -1;
   }, "pprint(function) shows source");
diff --git a/browser/devtools/webconsole/test/head.js b/browser/devtools/webconsole/test/head.js
--- a/browser/devtools/webconsole/test/head.js
+++ b/browser/devtools/webconsole/test/head.js
@@ -1,19 +1,20 @@
 /* vim:set ts=2 sw=2 sts=2 et: */
 /* This Source Code Form is subject to the terms of the Mozilla Public
  * License, v. 2.0. If a copy of the MPL was not distributed with this
  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */
 
-let WebConsoleUtils, gDevTools, TargetFactory, console, promise, require;
+let WebConsoleUtils, gDevTools, TargetFactory, console, promise, require, Task;
 
 (() => {
   gDevTools = Cu.import("resource:///modules/devtools/gDevTools.jsm", {}).gDevTools;
   console = Cu.import("resource://gre/modules/devtools/Console.jsm", {}).console;
   promise = Cu.import("resource://gre/modules/commonjs/sdk/core/promise.js", {}).Promise;
+  Task = Cu.import("resource://gre/modules/Task.jsm", {}).Task;
 
   let tools = Cu.import("resource://gre/modules/devtools/Loader.jsm", {}).devtools;
   let utils = tools.require("devtools/toolkit/webconsole/utils");
   TargetFactory = tools.TargetFactory;
   WebConsoleUtils = utils.Utils;
   require = tools.require;
 })();
 // promise._reportErrors = true; // please never leave me.
@@ -147,25 +148,30 @@ function findLogEntry(aString)
  * Open the Web Console for the given tab.
  *
  * @param nsIDOMElement [aTab]
  *        Optional tab element for which you want open the Web Console. The
  *        default tab is taken from the global variable |tab|.
  * @param function [aCallback]
  *        Optional function to invoke after the Web Console completes
  *        initialization (web-console-created).
+ * @return object
+ *         A promise that is resolved once the web console is open.
  */
 function openConsole(aTab, aCallback = function() { })
 {
+  let deferred = promise.defer();
   let target = TargetFactory.forTab(aTab || tab);
   gDevTools.showToolbox(target, "webconsole").then(function(toolbox) {
     let hud = toolbox.getCurrentPanel().hud;
     hud.jsterm._lazyVariablesView = false;
     aCallback(hud);
+    deferred.resolve(hud);
   });
+  return deferred.promise;
 }
 
 /**
  * Close the Web Console for the given tab.
  *
  * @param nsIDOMElement [aTab]
  *        Optional tab element for which you want close the Web Console. The
  *        default tab is taken from the global variable |tab|.
diff --git a/browser/devtools/webconsole/webconsole.js b/browser/devtools/webconsole/webconsole.js
--- a/browser/devtools/webconsole/webconsole.js
+++ b/browser/devtools/webconsole/webconsole.js
@@ -4257,16 +4257,17 @@ JSTerm.prototype = {
     }
     else if (completionType == this.COMPLETE_BACKWARD) {
       popup.selectPreviousItem();
     }
     else if (completionType == this.COMPLETE_FORWARD) {
       popup.selectNextItem();
     }
 
+    this.emit("autocomplete-updated");
     aCallback && aCallback(this);
   },
 
   onAutocompleteSelect: function JSTF_onAutocompleteSelect()
   {
     // Render the suggestion only if the cursor is at the end of the input.
     if (this.inputNode.selectionStart != this.inputNode.value.length) {
       return;
